<!--pages/analyze/analyze.wxml-->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header">
    <view class="back-btn" bindtap="goBack">
      <text class="icon">â†</text>
    </view>
    <text class="title">æ•°æ®åˆ†ææœåŠ¡</text>
    <view class="status-dot {{status.online ? 'online' : 'offline'}}"></view>
  </view>

  <!-- æ•°æ®ä¸Šä¼ åŒºåŸŸ -->
  <view class="card">
    <view class="card-title">
      <text class="icon">ğŸ“</text>
      <text class="text">æ•°æ®ä¸Šä¼ </text>
    </view>
    <text class="card-desc">ä¸Šä¼ CSVã€JSONæˆ–Excelæ–‡ä»¶è¿›è¡Œæ•°æ®åˆ†æ</text>
    
    <view class="upload-area" bindtap="chooseFile">
      <view class="upload-icon">
        <text class="icon">ğŸ“¤</text>
      </view>
      <text class="upload-text">ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</text>
      <text class="upload-hint">æ”¯æŒCSVã€JSONã€Excelæ ¼å¼</text>
    </view>

    <view wx:if="{{selectedFile}}" class="file-info">
      <text class="file-name">{{selectedFile.name}}</text>
      <text class="file-size">{{selectedFile.size}} bytes</text>
      <button class="btn-remove" bindtap="removeFile">ç§»é™¤</button>
    </view>
  </view>

  <!-- åˆ†æé€‰é¡¹ -->
  <view class="card">
    <view class="card-title">
      <text class="icon">âš™ï¸</text>
      <text class="text">åˆ†æé€‰é¡¹</text>
    </view>
    
    <view class="option-group">
      <text class="option-label">åˆ†æç±»å‹</text>
      <picker 
        range="{{analysisTypes}}" 
        value="{{selectedTypeIndex}}" 
        bindchange="onTypeChange"
        class="picker"
      >
        <view class="picker-value">
          {{analysisTypes[selectedTypeIndex]}}
          <text class="picker-arrow">â–¼</text>
        </view>
      </picker>
    </view>

    <view class="option-group">
      <text class="option-label">æ•°æ®èŒƒå›´</text>
      <picker 
        range="{{dataRanges}}" 
        value="{{selectedRangeIndex}}" 
        bindchange="onRangeChange"
        class="picker"
      >
        <view class="picker-value">
          {{dataRanges[selectedRangeIndex]}}
          <text class="picker-arrow">â–¼</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- åˆ†ææŒ‰é’® -->
  <button 
    class="analyze-btn" 
    bindtap="startAnalysis" 
    disabled="{{!selectedFile || analyzing}}"
    loading="{{analyzing}}"
  >
    {{analyzing ? 'åˆ†æä¸­...' : 'å¼€å§‹åˆ†æ'}}
  </button>

  <!-- åˆ†æç»“æœ -->
  <view wx:if="{{analysisResult}}" class="card result-card">
    <view class="card-title">
      <text class="icon">ğŸ“Š</text>
      <text class="text">åˆ†æç»“æœ</text>
    </view>
    
    <view class="result-section">
      <text class="section-title">æ•°æ®æ¦‚è§ˆ</text>
      <view class="stats-grid">
        <view class="stat-item">
          <text class="stat-value">{{analysisResult.stats && analysisResult.stats.rowCount ? analysisResult.stats.rowCount : 0}}</text>
          <text class="stat-label">æ•°æ®è¡Œæ•°</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{analysisResult.stats && analysisResult.stats.columnCount ? analysisResult.stats.columnCount : 0}}</text>
          <text class="stat-label">å­—æ®µæ•°é‡</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{analysisResult.stats && analysisResult.stats.completeness ? analysisResult.stats.completeness : '0%'}}</text>
          <text class="stat-label">æ•°æ®å®Œæ•´æ€§</text>
        </view>
      </view>
    </view>

    <view class="result-section">
      <text class="section-title">å…³é”®æ´å¯Ÿ</text>
      <view wx:for="{{analysisResult.insights ? analysisResult.insights : []}}" wx:key="index" class="insight-item">
        <text class="insight-text">{{item}}</text>
      </view>
    </view>

    <view class="result-section">
      <text class="section-title">å»ºè®®</text>
      <view wx:for="{{analysisResult.recommendations ? analysisResult.recommendations : []}}" wx:key="index" class="recommendation-item">
        <text class="recommendation-text">{{item}}</text>
      </view>
    </view>
  </view>

  <!-- é”™è¯¯ä¿¡æ¯ -->
  <view wx:if="{{error}}" class="error-card">
    <text class="error-icon">âŒ</text>
    <text class="error-text">{{error}}</text>
  </view>
</view>