## 气候餐厅数字化系统开发策划（项目主线版）

### 1. 总体策略

#### 1.1 核心功能模块

气候餐厅数字化系统包含以下 **5 大核心功能模块**：

1. **气候餐厅认证**：餐厅入驻、认证申请、审核流程、证书管理
2. **碳足迹核算**：菜单碳足迹计算、订单碳统计、碳标签生成与管理
3. **供应链溯源**：供应商管理、食材批次追踪、溯源链构建与展示
4. **餐厅运营**：订单管理、积分系统、运营台账、行为统计
5. **报表与生态拓展**：数据报表、ESG 报告、对外接口、生态联动

#### 1.2 开发策略

- **目标聚焦**：围绕"气候餐厅"主线，以 5 大核心功能模块为支撑，构建完整的数字化运营闭环。
- **节奏划分**：按 4 个阶段推进——基础设施搭建 → 认证上线 → 碳核算与运营闭环 → 报表监管与生态拓展。
- **并行原则**：可并行的工作仅限同阶段内的互不依赖任务；跨阶段必须满足前置产出。

---

### 2. 阶段与里程碑

| 阶段                                  | 核心目标                                           | 主要依赖                   |
| ------------------------------------- | -------------------------------------------------- | -------------------------- |
| Phase 0. 准备期（1-2 周）             | 明确范围、架构底座、基础设施可用性                 | 无                         |
| Phase 1. 认证上线（4-6 周）           | 核心模块 1：建立餐厅入驻、认证申请与审核全链路     | Phase 0 完成               |
| Phase 2. 碳核算与运营闭环（5-7 周）   | 核心模块 2-4：完成碳核算、供应链溯源、餐厅运营闭环 | Phase 1 数据结构与接口稳定 |
| Phase 3. 报表监管与生态拓展（5-6 周） | 核心模块 5：数据快照、ESG 报告、对外接口、生态联动 | Phase 2 运行数据稳定       |

---

### 3. 详细步骤

#### Phase 0 ｜准备期

1. **范围与目标确认**
   - 内容：梳理气候餐厅业务需求、迭代边界、成功指标；输出《主线范围说明》。
   - 关键依赖：产品、业务、数据、运营共识。
2. **架构评审与技术规划**
   - 内容：验证 v5 数据模型、云函数结构、前后端框架；制定接口命名规范、租户策略。
   - 依赖：数据库概念/逻辑模型；输出《技术执行计划》 + 关键技术风险评估。
3. **环境准备与工具链校准**
   - 内容：确认 CloudBase 环境、脚本部署、CI/CD、数据模拟工具；编写执行手册。
   - 依赖：已有 `init/migrate v5` 脚本；输出《环境就绪报告》。
4. **项目管理机制搭建**
   - 内容：建立里程碑、需求池、缺陷跟踪表；约定评审频次、验收标准。
   - 依赖：步骤 1-3 完成；输出《项目管理基线》。

> 输出物：范围说明、技术执行计划、环境报告、项目管理基线。  
> 进入条件：关键角色认可主线范围，环境脚本可执行。

---

#### Phase 1 ｜认证上线

**目标**：实现餐厅入驻 → 认证申请/审核 → 认证证书管理闭环。

1. **需求细化与原型确认**
   - 内容：拆解认证申请、资料提交、审核流程、证书管理等用户旅程，输出 PRD&原型。
   - 依赖：Phase0 范围；输出《认证模块需求包》。
2. **API 与数据合同设计**
   - 内容：定义认证流程、资料提交接口、审核工作流接口；编写 Swagger/接口文档。
   - 依赖：步骤 1；输出《API 契约 v1》。
3. **数据库与云函数实现**
   - 内容：按 `init-v5` 集合与索引表编写 schema 校验、云函数 CRUD；包含租户权限。
   - 依赖：步骤 2；输出云函数代码、单元测试。
4. **前端模块开发（B 端后台）**
   - 内容：认证申请、审核工作台、证书管理；与 API 接口联调。
   - 依赖：步骤 2、3；输出前端功能、测试用例。
5. **流程联调与验收**
   - 内容：以"新餐厅入驻"场景完成认证申请 → 资料审核 → 认证通过 → 证书颁发完整演练。
   - 依赖：步骤 3、4；输出《Phase1 验收报告》，收集问题。
6. **发布与运营手册**
   - 内容：编写操作指南、上线检查表、常见问题；交付运营与客服。
   - 依赖：验收通过。

> 输出物：PRD/接口文档/云函数代码/前端模块/验收报告/操作手册。  
> 进入 Phase2 条件：验收报告通过，关键缺陷关闭，文档归档。

---

#### Phase 2 ｜碳核算与运营闭环

**目标**：完成核心模块 2-4（碳足迹核算、供应链溯源、餐厅运营）的开发与集成，构建完整的运营闭环。

**核心模块 2：碳足迹核算**

1. **碳核算模块需求与技术实现**
   - 内容：定义菜单碳足迹计算、订单碳统计、碳标签生成等需求；实现碳核算算法、云函数与接口。
   - 依赖：Phase1 产出；输出《碳核算模块设计文档》。
2. **菜单管理与碳标签**
   - 内容：实现菜单录入、菜品碳足迹计算、碳标签生成与管理；支持批量计算与标签展示。
   - 依赖：步骤 1；输出菜单管理接口与前端页面。

**核心模块 3：供应链溯源**

3. **溯源模块需求与技术实现**
   - 内容：定义供应商、食材批次、溯源链展示需求；实现 `trace_*` 集合及接口。
   - 依赖：步骤 2；输出溯源接口与前端页面。

**核心模块 4：餐厅运营**

4. **数据流规划与补齐**
   - 内容：建立订单 → 用户 → 碳积分 → 行为记录 → 餐厅看板的数据流；明确调用来源及时序。
   - 依赖：步骤 2；输出《运营数据流设计》。
5. **订单/积分集成**
   - 内容：扩展 `restaurant_orders` 插入流程，更新碳积分账户；与现有 MyGarden 用户体系统一。
   - 依赖：步骤 4；需要与社区模块协同确认接口。
6. **运营台账与行为统计**
   - 内容：实现 `restaurant_operation_ledgers`、`restaurant_behavior_metrics` 采集与展示；提供 CSV/批量导入。
   - 依赖：步骤 5；输出报表 API 与看板。

**集成与验收**

7. **端到端联调测试**
   - 内容：模拟真实餐厅运营一周（菜单碳核算、订单、积分、溯源、台账），验证数据一致性、性能。
   - 依赖：步骤 2-6；输出《Phase2 数据一致性报告》。
8. **运营培训与上线**
   - 内容：制作运营指南、异常处理流程（补单、纠错、回滚）。
   - 依赖：联调通过。

> 输出物：碳核算模块、菜单管理、数据流设计、溯源模块、订单/积分接口、运营数据看板、联调报告、运营指南。  
> 进入 Phase3 条件：数据一致性 OK，关键链路无 P0 缺陷。

---

#### Phase 3 ｜报表监管与生态拓展

**目标**：完成核心模块 5（报表与生态拓展）的开发，建立数据快照、ESG 报表与对外输出能力，同时准备与社区、电商的深度联动。

1. **指标体系与快照设计**
   - 内容：整理认证、碳核算、运营指标，配置 `kpi_definitions`、`data_snapshots`；明确刷新频率。
   - 依赖：Phase2 数据流。
2. **报表与监管输出**
   - 内容：实现 ESG 报告模板、政府报送 API、批量导出功能；配置 `regulatory_exports`。
   - 依赖：步骤 1；输出报表前端与下载服务。
3. **生态联动梳理**
   - 内容：与“我的花园”积分体系、电商优惠、社区曝光等建立接口契约；制定阶段性 roadmap。
   - 依赖：步骤 1，需与其他事业线沟通。
4. **性能与安全加固**
   - 内容：执行压测、索引验证、数据备份策略；完善审计日志与权限模型。
   - 依赖：阶段性数据量达到一定规模。
5. **上线回顾与迭代计划**
   - 内容：收集使用反馈、评估目标达成度，规划下一阶段（如多城市复制、合作入口）。
   - 依赖：步骤 2、3。

> 输出物：指标体系文档、ESG 报表功能、对外接口计划、安全压测报告、迭代路线图。

---

### 4. 跨阶段协同事项

- **数据治理**：每阶段结束执行一次数据质量审查（字段完整度、索引命中率、备份恢复演练）。
- **接口管理**：所有跨团队接口（社区、电商）须在 Phase1/Phase2 前锁定版本，避免后期频繁改动。
- **文档与知识库**：遵循“阶段交付 → 文档落库 → 培训”的节奏，确保运营/客服接手顺畅。
- **评审机制**：每阶段设立 Go/No-Go 评审（范围、技术、用户体验三方），确认是否进入下一阶段。

---

### 5. 项目管理建议

- **节奏控制**：每阶段内再拆 2-3 个迭代，保证需求、开发、测试、验收闭环；关键里程碑设缓冲期。
- **风险管理**：建立风险清单（如数据链路跨业务、认证政策更新、外部合作依赖），每周复盘状态。
- **产能协调**：主线团队固定投入，跨业务需求通过接口协议交付，避免资源被拉散。
- **成功指标**：围绕认证通过率、碳核算准确度、运营数据覆盖率、报表出具效率等指标衡量阶段成果。
