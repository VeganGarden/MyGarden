# 气候餐厅业务需求（主线范围说明）

> 版本：v1.0  
> 日期：2025-11-12  
> 编写人：项目策划组  
> 关联文档：`气候餐厅数字化系统策划方案`、`气候餐厅主线开发策划`、`气候餐厅数据库概念模型 v1`

---

## 1. 背景与目标

### 1.1 核心功能模块

气候餐厅数字化系统包含以下 **5 大核心功能模块**：

1. **核心模块 1：气候餐厅认证** - 餐厅入驻、认证申请、审核流程、证书管理
2. **核心模块 2：碳足迹核算** - 菜单碳足迹计算、订单碳统计、碳标签生成与管理
3. **核心模块 3：供应链溯源** - 供应商管理、食材批次追踪、溯源链构建与展示
4. **核心模块 4：餐厅运营** - 订单管理、积分系统、运营台账、行为统计
5. **核心模块 5：报表与生态拓展** - 数据报表、ESG 报告、对外接口、生态联动

### 1.2 业务目标

- **市场动因**：气候餐厅认证与低碳运营成为餐饮行业的差异化卖点，亟需数字化工具支撑认证流程、碳核算和持续运营。
- **业务目标**：
  - **核心模块 1**：支撑餐厅快速完成气候认证申请、审核、证书发布与复审。
  - **核心模块 2**：提供菜品与餐厅级碳足迹计算、标签展示、积分激励，驱动低碳消费。
  - **核心模块 3**：构建供应链溯源体系，实现食材从供应商到餐厅的全链条可追溯。
  - **核心模块 4**：支撑餐厅日常运营管理，实现订单、积分、运营台账、行为记录等数据的闭环流转。
  - **核心模块 5**：为政府、合作伙伴输出标准化 ESG/监管报告，拓展生态合作。
- **范围界定**：本需求覆盖气候餐厅主线所需的 B 端餐厅后台、云函数服务、数据库、报表与对外接口；C 端、社区、电商只保留必要的接口依赖，后续另行扩展。

---

## 2. 关键角色与场景

| 角色            | 诉求                             | 关键场景                                   | 涉及核心模块                     |
| --------------- | -------------------------------- | ------------------------------------------ | -------------------------------- |
| 餐厅管理员      | 完成认证、配置菜单、查看运营数据 | 认证申请、菜品录入、碳核算、订单与积分查询、供应商管理 | 核心模块 1、2、3、4                 |
| 平台审核员      | 审核认证材料、发布证书、复审提醒 | 认证审核、复审任务、证书管理、供应商审核   | 核心模块 1、3                     |
| 平台运营        | 管理运营活动、监控数据、输出报告 | 营销配置、运营台账、报表导出               | 核心模块 4、5                    |
| 碳核算专员      | 维护碳系数、模型参数、核算流程   | 碳数据维护、核算任务、模型版本管理         | 核心模块 2                       |
| 政府/外部合作方 | 获取标准化报告、监管数据         | ESG 报告、数据导出、API 对接               | 核心模块 5                       |
| 技术运维        | 保障系统可用性、数据安全         | 权限配置、审计日志、备份与监控             | 支撑功能（权限与审计）           |

---

## 3. 业务边界与假设

- 本阶段仅支持**单一平台托管多餐厅**的模式，租户隔离通过 `tenantId` 管理；暂不引入跨平台数据混合。
- 菜品碳核算基于平台提供的标准化食材/配方库及碳排系数，餐厅管理员仅支持在库内选配或发起新增申请；第三方核算机构对接作为后续扩展。
- 积分体系与“我的花园”共享账户，但餐厅侧只负责记录与同步，不处理社区玩法。
- 溯源信息聚焦于餐厅提供的供应商与食材批次，暂不覆盖区块链等高级方案。
- 报表与对外接口首期支持平台统一导出/推送，开放 API 需合作协议后上线。

---

## 4. 用户旅程概述

1. **核心模块 1：认证入驻旅程**：餐厅注册 → 提交资料 → 平台审核 → 证书发布 → 复审提醒。
2. **核心模块 2：菜品碳算旅程**：从标准库选配菜品 → 确认/配置配方与食材 → 系统自动计算碳足迹 → 标签上线 → 顾客查看。
3. **核心模块 3：溯源查询旅程**：维护供应商/食材批次 → 生成溯源链 → 平台审核 → 对外展示或扫码查询。
4. **核心模块 4：运营管理旅程**：接收订单 → 同步碳积分 → 填写运营台账 → 查看行为与指标 → 生成报表。
5. **核心模块 5：监管输出旅程**：按月生成数据快照 → 汇总指标 → 导出 ESG/监管报告 → 提交政府/合作方。

---

## 5. 功能需求

### 5.1 核心模块 1：气候餐厅认证

- **认证申请**：餐厅填写基础信息、菜单、供应链、能源与浪费数据；支持草稿保存、附件上传、版本记录。
- **审核流程**：审核员查看申请、添加评估意见、驳回/通过；支持阶段拆分（资料审查、现场核查、复评）。
- **证书管理**: 自动生成证书编号、有效期、展示资源；提供续期提醒、撤销、复审记录。
- **成长激励**: 认证后可配置成长任务、勋章、曝光位，记录完成状态（Phase 2/3 扩展）。

### 5.2 核心模块 2：碳足迹核算

- **菜品维护**：支持从平台标准食材/配方库选配生成菜品，提供批量导入、配方版本管理、渠道展示配置（堂食/外卖/宣传物料）。
- **基础库运营**：平台碳核算专员维护标准食材、半成品与配方库；餐厅管理员可提交新增/变更申请，经审核后同步至库内供选配使用。
- **碳核算引擎**：依据标准配方与食材从碳系数库计算菜品/套餐碳足迹，支持模型版本、手动调整、核算日志，确保数据引用一致。
- **碳标签展示**：提供低/中/高碳标签、数值、评分等多种展示方式；可导出到线下物料。
- **订单碳汇总**：实时计算订单碳足迹，写入用户/餐厅记录，为积分与报表提供数据。

### 5.3 核心模块 3：供应链溯源

- **供应商档案**：记录供应商类型、证照、风险等级；支持平台审核。
- **食材批次**：维护食材批次、采收/加工节点、质检信息；关联菜品。
- **溯源链生成**：将供应商、批次、运输、餐厅加工等节点串联，生成链路视图与可信评分。
- **对外展示**：生成二维码或链接供顾客查询，支持版本与历史追溯。

### 5.4 核心模块 4：餐厅运营

- **订单整合**：接收餐厅点餐系统或小程序订单，完成状态同步，写入 `restaurant_orders`。
- **积分联动**：根据碳减排为用户记积分，更新 `points_accounts` 和 `carbon_credits`。
- **运营台账**：记录能源使用、浪费管理、培训活动等数据，支持手动录入/批量导入。
- **行为指标**：统计餐厅行为（低碳菜品占比、顾客行为等），生成 `restaurant_behavior_metrics`。

### 5.5 核心模块 5：报表与生态拓展

- **指标定义**：管理 KPI 字典、计算方法、数据血缘；与数据库 `kpi_definitions` 对应。
- **数据快照**：定期生成 `data_snapshots`，支撑运营看板与历史趋势。
- **ESG/监管报告**：按模板生成 PDF/Excel，支持导出与在线查看；记录 `regulatory_exports`。
- **政府/合作接口**：预留对接 API（如数据推送、报告上传）的扩展能力，控制权限与日志。

### 5.6 支撑功能：权限与审计

- **多租户隔离**：餐厅只可访问本租户数据，平台可按角色访问跨租户视图。
- **角色权限**：餐厅管理员、审核员、运营、碳核算专员、政府账号等角色分级管理。
- **审计日志**：记录关键操作（审核、数据修改、导出等）；与 `audit_logs` 集合对齐。
- **安全要求**：数据加密、访问控制、备份恢复策略需明确并执行。

---

## 6. 非功能需求

- **性能**：认证申请/菜品列表等常用接口响应时间 < 1s；碳核算批量任务在合理时间内完成（10 万条/小时级别）。
- **可靠性**：关键服务 99.5% 可用性；业务数据每日备份、支持数据回滚。
- **可扩展性**：数据库与接口需支持多租户扩展、分布式部署，满足多城市/多品牌推广。
- **合规性**：符合数据隐私法规、政府监管要求；记录用户授权与数据采集来源。
- **可维护性**：代码与配置统一版本管理，提供监控告警（慢查询、失败率等）。

---

## 7. 成功指标（KPI）

### 核心模块 1：气候餐厅认证
- 认证通过率 ≥ 80%，初次审核周期 ≤ 10 个工作日。

### 核心模块 2：碳足迹核算
- 菜品碳足迹覆盖率 ≥ 90%，标签展示准确率 ≥ 95%。

### 核心模块 3：供应链溯源
- 溯源数据填报率 ≥ 85%，溯源链完整性 ≥ 90%。

### 核心模块 4：餐厅运营
- 餐厅运营数据（台账、行为）填报率 ≥ 85%，碳积分同步成功率 100%。

### 核心模块 5：报表与生态拓展
- 报表生成时间 ≤ 5 分钟，数据准确性通过抽样校验。

### 整体指标
- 用户（餐厅管理员）满意度 ≥ 4.2/5，平台运营反馈无重大缺口。

---

## 8. 依赖与接口

- **内部依赖**：
  - MyGarden 用户与积分系统（账户信息、积分明细）。
  - 食材库/碳系数库（数据初始化、更新接口）。
  - 微信/小程序订单系统（订单接入、支付信息）。
- **外部依赖**：
  - 第三方认证机构（可选，核算数据校验）。
  - 政府监管平台（数据报送接口协议）。
- **接口策略**：采用 REST/HTTPS + 云函数触发方式，输出 Swagger 文档；跨团队接口需在阶段起始时锁定版本。

---

## 9. 风险与缓解

| 风险         | 描述                         | 缓解措施                           |
| ------------ | ---------------------------- | ---------------------------------- |
| 认证标准变动 | 政策或合作方要求调整指标     | 保持参数化配置，设置版本化字段     |
| 数据质量     | 餐厅填报不完整导致核算偏差   | 引入校验规则、采集引导、复审机制   |
| 系统负载     | 高并发导入或报表生成影响性能 | 设计异步任务、索引优化、队列缓冲   |
| 跨团队协调   | 与社区、电商接口变动频繁     | 建立接口评审与变更流程，文档化协议 |
| 隐私与合规   | 溯源和用户数据涉及敏感信息   | 实施权限控制、脱敏、审计记录       |

---

## 10. 里程碑与交付物待办

| 里程碑       | 核心模块                                           | 核心交付                                             | 目标时间 |
| ------------ | -------------------------------------------------- | ---------------------------------------------------- | -------- |
| Phase 0 完成 | -                                                  | 本需求文档、技术执行计划、环境就绪报告、项目管理基线 | T+2 周   |
| Phase 1 完成 | 核心模块 1：气候餐厅认证                           | 认证功能上线、验收报告、运营手册                     | T+8 周   |
| Phase 2 完成 | 核心模块 2-4：碳足迹核算、供应链溯源、餐厅运营     | 碳核算与运营闭环、数据一致性报告、运营培训资料       | T+14 周  |
| Phase 3 完成 | 核心模块 5：报表与生态拓展                         | ESG 报表/监管接口、性能与安全报告、迭代 roadmap      | T+20 周  |

---

## 11. 变更管理

- 需求变更需由产品负责人发起，评估对数据模型、接口、交付节奏的影响。
- 重大变更（影响阶段目标或跨团队接口）须经过项目例会评审并同步至文档。
- 定期（双周）更新需求状态，确保执行团队与运营方保持一致认知。

---

## 12. 附录

- 术语对照：`tenantId`（租户 ID）、`KPI`（关键绩效指标）、`ESG`（环境、社会、治理）、`溯源链`（Trace Chain）等。
- 相关链接：`数据库集合总览.csv`、`索引配置表.csv`、`气候餐厅数据库概念模型 v1`.
