# æ•°æ®åº“ç´¢å¼•åˆ›å»ºæ‰‹å†Œ

## ğŸ“‹ æ¦‚è¿°

ç”±äºè…¾è®¯äº‘å¼€å‘çš„ MongoDB ä¸æ”¯æŒé€šè¿‡ä»£ç åˆ›å»ºç´¢å¼•ï¼Œéœ€è¦åœ¨**äº‘å¼€å‘æ§åˆ¶å°**æ‰‹åŠ¨åˆ›å»ºã€‚

æœ¬æ–‡æ¡£æä¾› 28 ä¸ªç´¢å¼•çš„è¯¦ç»†åˆ›å»ºæ­¥éª¤å’Œé…ç½®å‚æ•°ã€‚

## âš ï¸ é‡è¦è¯´æ˜

- **å‰ç½®æ¡ä»¶**: å¿…é¡»å…ˆæ‰§è¡Œ `database` äº‘å‡½æ•°åˆ›å»º 12 ä¸ªé›†åˆ
- **åˆ›å»ºä½ç½®**: è…¾è®¯äº‘å¼€å‘æ§åˆ¶å° â†’ æ•°æ®åº“ â†’ é€‰æ‹©é›†åˆ â†’ ç´¢å¼•ç®¡ç†
- **åˆ›å»ºæ—¶é—´**: é¢„è®¡éœ€è¦ 15-20 åˆ†é’Ÿ
- **å¿…é¡»å®Œæˆ**: ç´¢å¼•æ˜¯æŸ¥è¯¢æ€§èƒ½çš„å…³é”®ï¼Œå¿…é¡»å…¨éƒ¨åˆ›å»º

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è®¿é—®è·¯å¾„

1. ç™»å½• https://console.cloud.tencent.com/tcb
2. é€‰æ‹©æ‚¨çš„ç¯å¢ƒï¼ˆ`my-garden-app-env`ï¼‰
3. ç‚¹å‡»å·¦ä¾§èœå•ã€Œæ•°æ®åº“ã€
4. ç‚¹å‡»ã€Œé›†åˆç®¡ç†ã€

---

## ğŸ“Š ç´¢å¼•åˆ›å»ºæ¸…å•ï¼ˆ28 ä¸ªï¼‰

### 1ï¸âƒ£ users é›†åˆï¼ˆ3 ä¸ªç´¢å¼•ï¼‰

#### ç´¢å¼• 1: openId_unique

**ç”¨é€”**: ç”¨æˆ·ç™»å½•æŸ¥è¯¢ï¼ˆå”¯ä¸€ç´¢å¼•ï¼‰  
**ä¼˜å…ˆçº§**: â­â­â­â­â­ æœ€é«˜

**åˆ›å»ºæ­¥éª¤**:

1. é€‰æ‹© `users` é›†åˆ
2. ç‚¹å‡»ã€Œç´¢å¼•ç®¡ç†ã€â†’ã€Œæ–°å»ºç´¢å¼•ã€
3. å¡«å†™é…ç½®ï¼š

| å­—æ®µ     | é…ç½®å€¼        |
| -------- | ------------- |
| ç´¢å¼•åç§° | openId_unique |
| ç´¢å¼•å­—æ®µ | openId        |
| æ’åºæ–¹å¼ | å‡åº(1)       |
| ç´¢å¼•å±æ€§ | âœ… å”¯ä¸€ç´¢å¼•   |

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "openId_unique",
  "keys": [{ "name": "openId", "direction": "1" }],
  "unique": true
}
```

#### ç´¢å¼• 2: level_points_ranking

**ç”¨é€”**: æ’è¡Œæ¦œæŸ¥è¯¢ï¼ˆå¤åˆç´¢å¼•ï¼‰  
**ä¼˜å…ˆçº§**: â­â­â­â­

**åˆ›å»ºæ­¥éª¤**:

1. ç‚¹å‡»ã€Œæ–°å»ºç´¢å¼•ã€
2. æ·»åŠ ä¸¤ä¸ªå­—æ®µï¼š

| å­—æ®µ     | é…ç½®å€¼               |
| -------- | -------------------- |
| ç´¢å¼•åç§° | level_points_ranking |
| å­—æ®µ 1   | levelï¼Œé™åº(-1)      |
| å­—æ®µ 2   | pointsï¼Œé™åº(-1)     |

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "level_points_ranking",
  "keys": [
    { "name": "level", "direction": "-1" },
    { "name": "points", "direction": "-1" }
  ]
}
```

#### ç´¢å¼• 3: lastLoginAt_index

**ç”¨é€”**: æ´»è·ƒåº¦ç»Ÿè®¡  
**ä¼˜å…ˆçº§**: â­â­â­

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "lastLoginAt_index",
  "keys": [{ "name": "lastLoginAt", "direction": "-1" }]
}
```

---

### 2ï¸âƒ£ user_sessions é›†åˆï¼ˆ3 ä¸ªç´¢å¼•ï¼‰

#### ç´¢å¼• 1: userId_expiresAt_index

**ç”¨é€”**: ä¼šè¯ç®¡ç†  
**ä¼˜å…ˆçº§**: â­â­â­â­

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "userId_expiresAt_index",
  "keys": [
    { "name": "userId", "direction": "1" },
    { "name": "expiresAt", "direction": "1" }
  ]
}
```

#### ç´¢å¼• 2: accessToken_index

**ç”¨é€”**: Token éªŒè¯  
**ä¼˜å…ˆçº§**: â­â­â­â­â­

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "accessToken_index",
  "keys": [{ "name": "accessToken", "direction": "1" }]
}
```

#### ç´¢å¼• 3: expiresAt_ttl

**ç”¨é€”**: TTL è‡ªåŠ¨æ¸…ç†è¿‡æœŸä¼šè¯  
**ä¼˜å…ˆçº§**: â­â­â­â­â­

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "expiresAt_ttl",
  "keys": [{ "name": "expiresAt", "direction": "1" }],
  "expireAfterSeconds": 0
}
```

**æ³¨æ„**: è…¾è®¯äº‘å¯èƒ½ä¸æ”¯æŒ TTL ç´¢å¼•ï¼Œå¦‚ä¸æ”¯æŒå¯è·³è¿‡ï¼Œä½¿ç”¨å®šæ—¶äº‘å‡½æ•°æ¸…ç†ã€‚

---

### 3ï¸âƒ£ meals é›†åˆï¼ˆ4 ä¸ªç´¢å¼•ï¼‰â­ æœ€é‡è¦

#### ç´¢å¼• 1: userId_mealDate_index

**ç”¨é€”**: ä¸ªäººé¤é£Ÿè®°å½•æŸ¥è¯¢ï¼ˆæœ€é«˜é¢‘æŸ¥è¯¢ï¼‰  
**ä¼˜å…ˆçº§**: â­â­â­â­â­ æœ€é«˜

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "userId_mealDate_index",
  "keys": [
    { "name": "userId", "direction": "1" },
    { "name": "mealDate", "direction": "-1" }
  ]
}
```

#### ç´¢å¼• 2: userId_createdAt_index

**ç”¨é€”**: æœ€è¿‘è®°å½•æŸ¥è¯¢  
**ä¼˜å…ˆçº§**: â­â­â­â­

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "userId_createdAt_index",
  "keys": [
    { "name": "userId", "direction": "1" },
    { "name": "createdAt", "direction": "-1" }
  ]
}
```

#### ç´¢å¼• 3: userId_source_orderId_unique

**ç”¨é€”**: é˜²æ­¢ç¬¬ä¸‰æ–¹è®¢å•é‡å¤åŒæ­¥ï¼ˆå”¯ä¸€ç¨€ç–ç´¢å¼•ï¼‰  
**ä¼˜å…ˆçº§**: â­â­â­â­â­ æœ€é«˜

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "userId_source_orderId_unique",
  "keys": [
    { "name": "userId", "direction": "1" },
    { "name": "source", "direction": "1" },
    { "name": "sourceOrderId", "direction": "1" }
  ],
  "unique": true,
  "sparse": true
}
```

**æ³¨æ„**: å¦‚æœæ§åˆ¶å°ä¸æ”¯æŒç¨€ç–ç´¢å¼•ï¼Œåˆ™åˆ›å»ºä¸ºæ™®é€šå”¯ä¸€ç´¢å¼•ã€‚

#### ç´¢å¼• 4: isPublic_createdAt_index

**ç”¨é€”**: å…¬å¼€åŠ¨æ€æŸ¥è¯¢  
**ä¼˜å…ˆçº§**: â­â­â­

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "isPublic_createdAt_index",
  "keys": [
    { "name": "isPublic", "direction": "1" },
    { "name": "createdAt", "direction": "-1" }
  ]
}
```

---

### 4ï¸âƒ£ daily_stats é›†åˆï¼ˆ3 ä¸ªç´¢å¼•ï¼‰

#### ç´¢å¼• 1: userId_date_index

**ç”¨é€”**: ä¸ªäººç»Ÿè®¡æŸ¥è¯¢  
**ä¼˜å…ˆçº§**: â­â­â­â­â­

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "userId_date_index",
  "keys": [
    { "name": "userId", "direction": "1" },
    { "name": "date", "direction": "-1" }
  ]
}
```

#### ç´¢å¼• 2: date_carbonReduction_ranking

**ç”¨é€”**: æ¯æ—¥æ’è¡Œæ¦œæŸ¥è¯¢  
**ä¼˜å…ˆçº§**: â­â­â­â­

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "date_carbonReduction_ranking",
  "keys": [
    { "name": "date", "direction": "-1" },
    { "name": "totalCarbonReduction", "direction": "-1" }
  ]
}
```

#### ç´¢å¼• 3: userId_date_unique

**ç”¨é€”**: æ•°æ®å”¯ä¸€æ€§ä¿è¯ï¼ˆé˜²æ­¢é‡å¤ç»Ÿè®¡ï¼‰  
**ä¼˜å…ˆçº§**: â­â­â­â­â­

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "userId_date_unique",
  "keys": [
    { "name": "userId", "direction": "1" },
    { "name": "date", "direction": "1" }
  ],
  "unique": true
}
```

---

### 5ï¸âƒ£ gardens é›†åˆï¼ˆ1 ä¸ªç´¢å¼•ï¼‰

#### ç´¢å¼• 1: userId_unique

**ç”¨é€”**: ä¸ªäººèŠ±å›­æŸ¥è¯¢ï¼ˆå”¯ä¸€ç´¢å¼•ï¼‰  
**ä¼˜å…ˆçº§**: â­â­â­â­â­

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "userId_unique",
  "keys": [{ "name": "userId", "direction": "1" }],
  "unique": true
}
```

---

### 6ï¸âƒ£ ingredients é›†åˆï¼ˆ3 ä¸ªç´¢å¼•ï¼‰

#### ç´¢å¼• 1: name_index

**ç”¨é€”**: é£Ÿæåç§°æŸ¥è¯¢  
**ä¼˜å…ˆçº§**: â­â­â­â­

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "name_index",
  "keys": [{ "name": "name", "direction": "1" }]
}
```

#### ç´¢å¼• 2: category_index

**ç”¨é€”**: åˆ†ç±»æŸ¥è¯¢  
**ä¼˜å…ˆçº§**: â­â­â­

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "category_index",
  "keys": [{ "name": "category", "direction": "1" }]
}
```

#### ç´¢å¼• 3: name_fulltext

**ç”¨é€”**: å…¨æ–‡æœç´¢ï¼ˆæ–‡æœ¬ç´¢å¼•ï¼‰  
**ä¼˜å…ˆçº§**: â­â­â­â­

**åˆ›å»ºæ­¥éª¤**:

1. é€‰æ‹©ç´¢å¼•ç±»å‹ï¼šã€Œæ–‡æœ¬ç´¢å¼•ã€
2. é€‰æ‹©å­—æ®µï¼šname, nameEn
3. è®¾ç½®æƒé‡ï¼šname(10), nameEn(5)
4. è¯­è¨€ï¼šChinese

**æ³¨æ„**: å¦‚æœæ§åˆ¶å°ä¸æ”¯æŒæ–‡æœ¬ç´¢å¼•ï¼Œå¯ä»¥æš‚æ—¶è·³è¿‡ï¼Œä½¿ç”¨æ­£åˆ™æŸ¥è¯¢ä»£æ›¿ã€‚

---

### 7ï¸âƒ£ recipes é›†åˆï¼ˆ2 ä¸ªç´¢å¼•ï¼‰

#### ç´¢å¼• 1: name_fulltext

**ç”¨é€”**: é£Ÿè°±åç§°æœç´¢  
**ä¼˜å…ˆçº§**: â­â­â­

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "name_fulltext",
  "keys": [{ "name": "name", "direction": "text" }]
}
```

**æ³¨æ„**: æ–‡æœ¬ç´¢å¼•å¯èƒ½ä¸æ”¯æŒï¼Œå¯ç”¨æ™®é€šç´¢å¼•ä»£æ›¿ï¼š

```json
{
  "name": "name_index",
  "keys": [{ "name": "name", "direction": "1" }]
}
```

#### ç´¢å¼• 2: usageCount_index

**ç”¨é€”**: çƒ­é—¨é£Ÿè°±æ’åº  
**ä¼˜å…ˆçº§**: â­â­â­

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "usageCount_index",
  "keys": [{ "name": "usageCount", "direction": "-1" }]
}
```

---

### 8ï¸âƒ£ sync_tasks é›†åˆï¼ˆ4 ä¸ªç´¢å¼•ï¼‰

#### ç´¢å¼• 1: userId_platform_status_index

**ç”¨é€”**: åŒæ­¥ä»»åŠ¡ç®¡ç†  
**ä¼˜å…ˆçº§**: â­â­â­â­

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "userId_platform_status_index",
  "keys": [
    { "name": "userId", "direction": "1" },
    { "name": "platform", "direction": "1" },
    { "name": "status", "direction": "1" }
  ]
}
```

#### ç´¢å¼• 2: status_nextRetry_index

**ç”¨é€”**: å¤±è´¥ä»»åŠ¡é‡è¯•é˜Ÿåˆ—  
**ä¼˜å…ˆçº§**: â­â­â­â­

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "status_nextRetry_index",
  "keys": [
    { "name": "status", "direction": "1" },
    { "name": "nextRetry", "direction": "1" }
  ]
}
```

#### ç´¢å¼• 3: platform_orderId_unique

**ç”¨é€”**: é˜²æ­¢åŒæ­¥ä»»åŠ¡é‡å¤  
**ä¼˜å…ˆçº§**: â­â­â­â­â­

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "platform_orderId_unique",
  "keys": [
    { "name": "platform", "direction": "1" },
    { "name": "orderId", "direction": "1" }
  ],
  "unique": true,
  "sparse": true
}
```

#### ç´¢å¼• 4: createdAt_ttl

**ç”¨é€”**: 30 å¤©åè‡ªåŠ¨åˆ é™¤ï¼ˆTTL ç´¢å¼•ï¼‰  
**ä¼˜å…ˆçº§**: â­â­â­

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "createdAt_ttl",
  "keys": [{ "name": "createdAt", "direction": "1" }],
  "expireAfterSeconds": 2592000
}
```

**æ³¨æ„**: å¦‚æœä¸æ”¯æŒ TTLï¼Œéœ€è¦åˆ›å»ºå®šæ—¶äº‘å‡½æ•°æ‰‹åŠ¨æ¸…ç†ã€‚

---

### 9ï¸âƒ£ platform_configs é›†åˆï¼ˆ1 ä¸ªç´¢å¼•ï¼‰

#### ç´¢å¼• 1: platform_unique

**ç”¨é€”**: å¹³å°é…ç½®å”¯ä¸€æ€§  
**ä¼˜å…ˆçº§**: â­â­â­â­

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "platform_unique",
  "keys": [{ "name": "platform", "direction": "1" }],
  "unique": true
}
```

---

### ğŸ”Ÿ friends é›†åˆï¼ˆ2 ä¸ªç´¢å¼•ï¼‰

#### ç´¢å¼• 1: userId_friendId_unique

**ç”¨é€”**: å¥½å‹å…³ç³»å”¯ä¸€æ€§  
**ä¼˜å…ˆçº§**: â­â­â­â­

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "userId_friendId_unique",
  "keys": [
    { "name": "userId", "direction": "1" },
    { "name": "friendId", "direction": "1" }
  ],
  "unique": true
}
```

#### ç´¢å¼• 2: userId_status_index

**ç”¨é€”**: å¥½å‹åˆ—è¡¨æŸ¥è¯¢  
**ä¼˜å…ˆçº§**: â­â­â­â­

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "userId_status_index",
  "keys": [
    { "name": "userId", "direction": "1" },
    { "name": "status", "direction": "1" }
  ]
}
```

---

### 1ï¸âƒ£1ï¸âƒ£ posts é›†åˆï¼ˆ2 ä¸ªç´¢å¼•ï¼‰

#### ç´¢å¼• 1: userId_createdAt_index

**ç”¨é€”**: ä¸ªäººåŠ¨æ€æŸ¥è¯¢  
**ä¼˜å…ˆçº§**: â­â­â­

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "userId_createdAt_index",
  "keys": [
    { "name": "userId", "direction": "1" },
    { "name": "createdAt", "direction": "-1" }
  ]
}
```

#### ç´¢å¼• 2: visibility_createdAt_index

**ç”¨é€”**: å…¬å¼€åŠ¨æ€æµ  
**ä¼˜å…ˆçº§**: â­â­â­

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "visibility_createdAt_index",
  "keys": [
    { "name": "visibility", "direction": "1" },
    { "name": "createdAt", "direction": "-1" }
  ]
}
```

---

### 1ï¸âƒ£2ï¸âƒ£ orders é›†åˆï¼ˆ2 ä¸ªç´¢å¼•ï¼‰

#### ç´¢å¼• 1: orderNo_unique

**ç”¨é€”**: è®¢å•å·å”¯ä¸€æ€§  
**ä¼˜å…ˆçº§**: â­â­â­â­â­

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "orderNo_unique",
  "keys": [{ "name": "orderNo", "direction": "1" }],
  "unique": true
}
```

#### ç´¢å¼• 2: userId_createdAt_index

**ç”¨é€”**: ç”¨æˆ·è®¢å•åˆ—è¡¨  
**ä¼˜å…ˆçº§**: â­â­â­â­

**æ§åˆ¶å° JSON é…ç½®**:

```json
{
  "name": "userId_createdAt_index",
  "keys": [
    { "name": "userId", "direction": "1" },
    { "name": "createdAt", "direction": "-1" }
  ]
}
```

---

## ğŸ“‹ ç´¢å¼•åˆ›å»ºæ£€æŸ¥æ¸…å•

åˆ›å»ºå®Œæˆåï¼Œè¯·é€ä¸€ç¡®è®¤ï¼š

### ç”¨æˆ·åŸŸ

- [ ] users.openId_uniqueï¼ˆå”¯ä¸€ï¼‰
- [ ] users.level_points_rankingï¼ˆå¤åˆï¼‰
- [ ] users.lastLoginAt_index
- [ ] user_sessions.userId_expiresAt_index
- [ ] user_sessions.accessToken_index
- [ ] user_sessions.expiresAt_ttlï¼ˆTTLï¼Œå¯é€‰ï¼‰

### ç¢³è¶³è¿¹åŸŸ

- [ ] meals.userId_mealDate_indexï¼ˆâ­ æœ€é‡è¦ï¼‰
- [ ] meals.userId_createdAt_index
- [ ] meals.userId_source_orderId_uniqueï¼ˆå”¯ä¸€ç¨€ç–ï¼‰
- [ ] meals.isPublic_createdAt_index
- [ ] daily_stats.userId_date_index
- [ ] daily_stats.date_carbonReduction_ranking
- [ ] daily_stats.userId_date_uniqueï¼ˆå”¯ä¸€ï¼‰

### èŠ±å›­åŸŸ

- [ ] gardens.userId_uniqueï¼ˆå”¯ä¸€ï¼‰

### åŸºç¡€æ•°æ®åŸŸ

- [ ] ingredients.name_index
- [ ] ingredients.category_index
- [ ] ingredients.name_fulltextï¼ˆæ–‡æœ¬ç´¢å¼•ï¼Œå¯é€‰ï¼‰
- [ ] recipes.name_fulltextï¼ˆæ–‡æœ¬ç´¢å¼•ï¼Œå¯é€‰ï¼‰
- [ ] recipes.usageCount_index

### ç¬¬ä¸‰æ–¹åŒæ­¥åŸŸ

- [ ] sync_tasks.userId_platform_status_index
- [ ] sync_tasks.status_nextRetry_index
- [ ] sync_tasks.platform_orderId_uniqueï¼ˆå”¯ä¸€ç¨€ç–ï¼‰
- [ ] sync_tasks.createdAt_ttlï¼ˆTTLï¼Œå¯é€‰ï¼‰
- [ ] platform_configs.platform_uniqueï¼ˆå”¯ä¸€ï¼‰

### ç¤¾äº¤åŸŸ

- [ ] friends.userId_friendId_uniqueï¼ˆå”¯ä¸€ï¼‰
- [ ] friends.userId_status_index
- [ ] posts.userId_createdAt_index
- [ ] posts.visibility_createdAt_index

### ç§¯åˆ†å•†åŸåŸŸ

- [ ] orders.orderNo_uniqueï¼ˆå”¯ä¸€ï¼‰
- [ ] orders.userId_createdAt_index

**æ€»è®¡: 28 ä¸ªç´¢å¼•**  
**å¿…é¡»åˆ›å»º: 20 ä¸ªï¼ˆâ­â­â­â­â­ å’Œ â­â­â­â­ï¼‰**  
**å¯é€‰åˆ›å»º: 8 ä¸ªï¼ˆâ­â­â­ å’Œ TTL/æ–‡æœ¬ç´¢å¼•ï¼‰**

---

## ğŸ¯ ä¼˜å…ˆçº§è¯´æ˜

- â­â­â­â­â­ **æœ€é«˜ä¼˜å…ˆçº§**: å¿…é¡»ç«‹å³åˆ›å»ºï¼Œå½±å“æ ¸å¿ƒåŠŸèƒ½

  - users.openId_uniqueï¼ˆç™»å½•ï¼‰
  - meals.userId_mealDate_indexï¼ˆæœ€é«˜é¢‘æŸ¥è¯¢ï¼‰
  - meals.userId_source_orderId_uniqueï¼ˆé˜²é‡ï¼‰
  - daily_stats.userId_date_indexï¼ˆç»Ÿè®¡ï¼‰
  - gardens.userId_uniqueï¼ˆèŠ±å›­ï¼‰
  - user_sessions.accessToken_indexï¼ˆè®¤è¯ï¼‰
  - orders.orderNo_uniqueï¼ˆè®¢å•ï¼‰

- â­â­â­â­ **é«˜ä¼˜å…ˆçº§**: å½±å“æ€§èƒ½ï¼Œå»ºè®®åˆ›å»º

  - æ‰€æœ‰å¤åˆç´¢å¼•
  - æ’è¡Œæ¦œç›¸å…³ç´¢å¼•

- â­â­â­ **ä¸­ä¼˜å…ˆçº§**: å¯ä»¥åç»­åˆ›å»º
  - ç¤¾äº¤åŠŸèƒ½ç´¢å¼•
  - å…¨æ–‡æœç´¢ç´¢å¼•

---

## ğŸ’¡ æ§åˆ¶å°æ“ä½œæŠ€å·§

### æ–¹æ³• 1: å›¾å½¢ç•Œé¢åˆ›å»ºï¼ˆç®€å•ï¼‰

1. åœ¨äº‘å¼€å‘æ§åˆ¶å°é€‰æ‹©é›†åˆ
2. ç‚¹å‡»ã€Œç´¢å¼•ç®¡ç†ã€
3. ç‚¹å‡»ã€Œæ–°å»ºç´¢å¼•ã€
4. æŒ‰ç…§ä¸Šé¢çš„è¡¨æ ¼å¡«å†™
5. ç‚¹å‡»ã€Œç¡®å®šã€

### æ–¹æ³• 2: JSON å¯¼å…¥ï¼ˆå¿«é€Ÿï¼Œå¦‚æœæ”¯æŒï¼‰

å¦‚æœæ§åˆ¶å°æ”¯æŒ JSON å¯¼å…¥ï¼Œå¯ä»¥ç›´æ¥å¤åˆ¶ä¸Šé¢çš„ JSON é…ç½®ã€‚

### æ–¹æ³• 3: æ‰¹é‡åˆ›å»ºï¼ˆæ¨èï¼‰

å¤åˆ¶ä¸‹é¢çš„å®Œæ•´é…ç½®ï¼Œåœ¨æ§åˆ¶å°æŸ¥æ‰¾æ˜¯å¦æœ‰æ‰¹é‡å¯¼å…¥åŠŸèƒ½ï¼š

```json
{
  "users": [
    {
      "name": "openId_unique",
      "keys": [{ "name": "openId", "direction": "1" }],
      "unique": true
    },
    {
      "name": "level_points_ranking",
      "keys": [
        { "name": "level", "direction": "-1" },
        { "name": "points", "direction": "-1" }
      ]
    },
    {
      "name": "lastLoginAt_index",
      "keys": [{ "name": "lastLoginAt", "direction": "-1" }]
    }
  ],
  "user_sessions": [
    {
      "name": "userId_expiresAt_index",
      "keys": [
        { "name": "userId", "direction": "1" },
        { "name": "expiresAt", "direction": "1" }
      ]
    },
    {
      "name": "accessToken_index",
      "keys": [{ "name": "accessToken", "direction": "1" }]
    }
  ],
  "meals": [
    {
      "name": "userId_mealDate_index",
      "keys": [
        { "name": "userId", "direction": "1" },
        { "name": "mealDate", "direction": "-1" }
      ]
    },
    {
      "name": "userId_createdAt_index",
      "keys": [
        { "name": "userId", "direction": "1" },
        { "name": "createdAt", "direction": "-1" }
      ]
    },
    {
      "name": "userId_source_orderId_unique",
      "keys": [
        { "name": "userId", "direction": "1" },
        { "name": "source", "direction": "1" },
        { "name": "sourceOrderId", "direction": "1" }
      ],
      "unique": true,
      "sparse": true
    },
    {
      "name": "isPublic_createdAt_index",
      "keys": [
        { "name": "isPublic", "direction": "1" },
        { "name": "createdAt", "direction": "-1" }
      ]
    }
  ],
  "daily_stats": [
    {
      "name": "userId_date_index",
      "keys": [
        { "name": "userId", "direction": "1" },
        { "name": "date", "direction": "-1" }
      ]
    },
    {
      "name": "date_carbonReduction_ranking",
      "keys": [
        { "name": "date", "direction": "-1" },
        { "name": "totalCarbonReduction", "direction": "-1" }
      ]
    },
    {
      "name": "userId_date_unique",
      "keys": [
        { "name": "userId", "direction": "1" },
        { "name": "date", "direction": "1" }
      ],
      "unique": true
    }
  ],
  "gardens": [
    {
      "name": "userId_unique",
      "keys": [{ "name": "userId", "direction": "1" }],
      "unique": true
    }
  ],
  "ingredients": [
    {
      "name": "name_index",
      "keys": [{ "name": "name", "direction": "1" }]
    },
    {
      "name": "category_index",
      "keys": [{ "name": "category", "direction": "1" }]
    }
  ],
  "recipes": [
    {
      "name": "usageCount_index",
      "keys": [{ "name": "usageCount", "direction": "-1" }]
    }
  ],
  "sync_tasks": [
    {
      "name": "userId_platform_status_index",
      "keys": [
        { "name": "userId", "direction": "1" },
        { "name": "platform", "direction": "1" },
        { "name": "status", "direction": "1" }
      ]
    },
    {
      "name": "status_nextRetry_index",
      "keys": [
        { "name": "status", "direction": "1" },
        { "name": "nextRetry", "direction": "1" }
      ]
    },
    {
      "name": "platform_orderId_unique",
      "keys": [
        { "name": "platform", "direction": "1" },
        { "name": "orderId", "direction": "1" }
      ],
      "unique": true,
      "sparse": true
    }
  ],
  "platform_configs": [
    {
      "name": "platform_unique",
      "keys": [{ "name": "platform", "direction": "1" }],
      "unique": true
    }
  ],
  "friends": [
    {
      "name": "userId_friendId_unique",
      "keys": [
        { "name": "userId", "direction": "1" },
        { "name": "friendId", "direction": "1" }
      ],
      "unique": true
    },
    {
      "name": "userId_status_index",
      "keys": [
        { "name": "userId", "direction": "1" },
        { "name": "status", "direction": "1" }
      ]
    }
  ],
  "posts": [
    {
      "name": "userId_createdAt_index",
      "keys": [
        { "name": "userId", "direction": "1" },
        { "name": "createdAt", "direction": "-1" }
      ]
    },
    {
      "name": "visibility_createdAt_index",
      "keys": [
        { "name": "visibility", "direction": "1" },
        { "name": "createdAt", "direction": "-1" }
      ]
    }
  ],
  "orders": [
    {
      "name": "orderNo_unique",
      "keys": [{ "name": "orderNo", "direction": "1" }],
      "unique": true
    },
    {
      "name": "userId_createdAt_index",
      "keys": [
        { "name": "userId", "direction": "1" },
        { "name": "createdAt", "direction": "-1" }
      ]
    }
  ]
}
```

---

## ğŸ” éªŒè¯ç´¢å¼•åˆ›å»º

### æ£€æŸ¥æ–¹æ³•

åœ¨æ¯ä¸ªé›†åˆçš„ã€Œç´¢å¼•ç®¡ç†ã€é¡µé¢ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ï¼š

**users é›†åˆ**:

```
âœ“ _id_ï¼ˆç³»ç»Ÿé»˜è®¤ï¼‰
âœ“ openId_unique
âœ“ level_points_ranking
âœ“ lastLoginAt_index
```

**meals é›†åˆ**:

```
âœ“ _id_ï¼ˆç³»ç»Ÿé»˜è®¤ï¼‰
âœ“ userId_mealDate_index
âœ“ userId_createdAt_index
âœ“ userId_source_orderId_unique
âœ“ isPublic_createdAt_index
```

...ä¾æ­¤ç±»æ¨

### æ€§èƒ½éªŒè¯

åˆ›å»ºç´¢å¼•åï¼Œå¯ä»¥ä½¿ç”¨ `test-indexes` äº‘å‡½æ•°æµ‹è¯•æ€§èƒ½ã€‚

---

## â±ï¸ é¢„è®¡æ—¶é—´

- **æœ€é«˜ä¼˜å…ˆçº§ç´¢å¼•**ï¼ˆ7 ä¸ªï¼‰: çº¦ 5 åˆ†é’Ÿ
- **é«˜ä¼˜å…ˆçº§ç´¢å¼•**ï¼ˆ13 ä¸ªï¼‰: çº¦ 10 åˆ†é’Ÿ
- **ä¸­ä¼˜å…ˆçº§ç´¢å¼•**ï¼ˆ8 ä¸ªï¼‰: çº¦ 5 åˆ†é’Ÿ
- **æ€»è®¡**: çº¦ 20 åˆ†é’Ÿ

---

## ğŸš¨ å¸¸è§é—®é¢˜

### Q1: æŸä¸ªç´¢å¼•åˆ›å»ºå¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**åŸå› **:

- æ•°æ®ä¸ç¬¦åˆå”¯ä¸€æ€§çº¦æŸ
- ç´¢å¼•åç§°å†²çª
- ä¸æ”¯æŒæŸäº›ç´¢å¼•ç±»å‹ï¼ˆTTLã€ç¨€ç–ç´¢å¼•ï¼‰

**è§£å†³**:

- è·³è¿‡è¯¥ç´¢å¼•ï¼Œæ ‡è®°ä¸º"å¾…å¤„ç†"
- ç»§ç»­åˆ›å»ºå…¶ä»–ç´¢å¼•
- æ ¸å¿ƒç´¢å¼•å¿…é¡»åˆ›å»ºï¼Œå¯é€‰ç´¢å¼•å¯ä»¥æš‚ç¼“

### Q2: TTL ç´¢å¼•ä¸æ”¯æŒæ€ä¹ˆåŠï¼Ÿ

**è§£å†³**: åˆ›å»ºå®šæ—¶äº‘å‡½æ•°æ‰‹åŠ¨æ¸…ç†ï¼š

```javascript
// å®šæ—¶æ¸…ç†è¿‡æœŸä¼šè¯ï¼ˆæ¯å¤©æ‰§è¡Œï¼‰
exports.main = async () => {
  const db = cloud.database();
  const now = new Date();

  await db
    .collection("user_sessions")
    .where({
      expiresAt: db.command.lt(now),
    })
    .remove();
};
```

### Q3: ç¨€ç–ç´¢å¼•ä¸æ”¯æŒæ€ä¹ˆåŠï¼Ÿ

**è§£å†³**: åˆ›å»ºä¸ºæ™®é€šå”¯ä¸€ç´¢å¼•ï¼Œä½†è¦æ³¨æ„ï¼š

- æ‰€æœ‰æ–‡æ¡£éƒ½å¿…é¡»æœ‰è¿™ä¸ªå­—æ®µ
- æˆ–è€…æ”¹ä¸ºéå”¯ä¸€ç´¢å¼•

### Q4: æ–‡æœ¬ç´¢å¼•ä¸æ”¯æŒæ€ä¹ˆåŠï¼Ÿ

**è§£å†³**: ä½¿ç”¨æ­£åˆ™æŸ¥è¯¢ä»£æ›¿ï¼š

```javascript
// ä»£æ›¿å…¨æ–‡æœç´¢
db.collection("ingredients")
  .where({
    name: db.RegExp({
      regexp: "è±†è…",
      options: "i",
    }),
  })
  .get();
```

---

## ğŸ“Š ç´¢å¼•ç»Ÿè®¡

| é›†åˆ             | ç´¢å¼•æ•° | å¿…é¡»åˆ›å»º | å¯é€‰     |
| ---------------- | ------ | -------- | -------- |
| users            | 3      | 3        | 0        |
| user_sessions    | 3      | 2        | 1 (TTL)  |
| meals            | 4      | 4        | 0        |
| daily_stats      | 3      | 3        | 0        |
| gardens          | 1      | 1        | 0        |
| ingredients      | 3      | 2        | 1 (æ–‡æœ¬) |
| recipes          | 2      | 1        | 1 (æ–‡æœ¬) |
| sync_tasks       | 4      | 3        | 1 (TTL)  |
| platform_configs | 1      | 1        | 0        |
| friends          | 2      | 2        | 0        |
| posts            | 2      | 2        | 0        |
| orders           | 2      | 2        | 0        |
| **æ€»è®¡**         | **28** | **24**   | **4**    |

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-01-11  
**é¢„è®¡å®Œæˆæ—¶é—´**: 20 åˆ†é’Ÿ  
**ç»´æŠ¤å›¢é˜Ÿ**: MyGarden å¼€å‘å›¢é˜Ÿ
