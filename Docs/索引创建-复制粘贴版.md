# 索引创建 - 复制粘贴版

> 最简化的索引创建指引，适合快速批量创建

## 🎯 使用说明

1. 打开云开发控制台 → 数据库 → 集合管理
2. 选择集合 → 索引管理 → 新建索引
3. **复制下面的配置**，在表单中填写
4. 创建成功后，在下面打钩 ✅

---

## 📋 索引创建清单（32 个）

### 1️⃣ users 集合（3 个索引）

#### ✅ 索引 1/28

```
集合: users
索引名称: openId_unique
字段1: openId | 升序(1) | ✅勾选唯一索引
```

创建完成打钩：□

#### ✅ 索引 2/28

```
集合: users
索引名称: level_points_ranking
字段1: level | 降序(-1)
字段2: points | 降序(-1)
```

创建完成打钩：□

#### ✅ 索引 3/28

```
集合: users
索引名称: lastLoginAt_index
字段1: lastLoginAt | 降序(-1)
```

创建完成打钩：□

---

### 2️⃣ user_sessions 集合（2 个索引，跳过 TTL）

#### ✅ 索引 4/28

```
集合: user_sessions
索引名称: userId_expiresAt_index
字段1: userId | 升序(1)
字段2: expiresAt | 升序(1)
```

创建完成打钩：□

#### ✅ 索引 5/28

```
集合: user_sessions
索引名称: accessToken_index
字段1: accessToken | 升序(1)
```

创建完成打钩：□

---

### 3️⃣ meals 集合（4 个索引）⭐ 最重要

#### ✅ 索引 6/28 ⭐⭐⭐⭐⭐ 最高优先级

```
集合: meals
索引名称: userId_mealDate_index
字段1: userId | 升序(1)
字段2: mealDate | 降序(-1)
```

创建完成打钩：□

#### ✅ 索引 7/28

```
集合: meals
索引名称: userId_createdAt_index
字段1: userId | 升序(1)
字段2: createdAt | 降序(-1)
```

创建完成打钩：□

#### ✅ 索引 8/28 ⭐⭐⭐⭐⭐ 防重

```
集合: meals
索引名称: userId_source_orderId_unique
字段1: userId | 升序(1)
字段2: source | 升序(1)
字段3: sourceOrderId | 升序(1)
✅勾选唯一索引
```

创建完成打钩：□

**注意**：如果有"稀疏索引"选项，也勾选上。

#### ✅ 索引 9/28

```
集合: meals
索引名称: isPublic_createdAt_index
字段1: isPublic | 升序(1)
字段2: createdAt | 降序(-1)
```

创建完成打钩：□

---

### 4️⃣ daily_stats 集合（3 个索引）

#### ✅ 索引 10/28 ⭐⭐⭐⭐⭐

```
集合: daily_stats
索引名称: userId_date_index
字段1: userId | 升序(1)
字段2: date | 降序(-1)
```

创建完成打钩：□

#### ✅ 索引 11/28

```
集合: daily_stats
索引名称: date_carbonReduction_ranking
字段1: date | 降序(-1)
字段2: totalCarbonReduction | 降序(-1)
```

创建完成打钩：□

#### ✅ 索引 12/28 ⭐⭐⭐⭐⭐

```
集合: daily_stats
索引名称: userId_date_unique
字段1: userId | 升序(1)
字段2: date | 升序(1)
✅勾选唯一索引
```

创建完成打钩：□

---

### 5️⃣ gardens 集合（1 个索引）

#### ✅ 索引 13/28 ⭐⭐⭐⭐⭐

```
集合: gardens
索引名称: userId_unique
字段1: userId | 升序(1)
✅勾选唯一索引
```

创建完成打钩：□

---

### 6️⃣ ingredients 集合（2 个索引）

#### ✅ 索引 14/28

```
集合: ingredients
索引名称: name_index
字段1: name | 升序(1)
```

创建完成打钩：□

#### ✅ 索引 15/28

```
集合: ingredients
索引名称: category_index
字段1: category | 升序(1)
```

创建完成打钩：□

---

### 7️⃣ recipes 集合（1 个索引）

#### ✅ 索引 16/28

```
集合: recipes
索引名称: usageCount_index
字段1: usageCount | 降序(-1)
```

创建完成打钩：□

---

### 8️⃣ sync_tasks 集合（3 个索引）

#### ✅ 索引 17/28

```
集合: sync_tasks
索引名称: userId_platform_status_index
字段1: userId | 升序(1)
字段2: platform | 升序(1)
字段3: status | 升序(1)
```

创建完成打钩：□

#### ✅ 索引 18/28

```
集合: sync_tasks
索引名称: status_nextRetry_index
字段1: status | 升序(1)
字段2: nextRetry | 升序(1)
```

创建完成打钩：□

#### ✅ 索引 19/28

```
集合: sync_tasks
索引名称: platform_orderId_unique
字段1: platform | 升序(1)
字段2: orderId | 升序(1)
✅勾选唯一索引
```

创建完成打钩：□

---

### 9️⃣ platform_configs 集合（1 个索引）

#### ✅ 索引 20/28

```
集合: platform_configs
索引名称: platform_unique
字段1: platform | 升序(1)
✅勾选唯一索引
```

创建完成打钩：□

---

### 🔟 friends 集合（2 个索引）

#### ✅ 索引 21/28

```
集合: friends
索引名称: userId_friendId_unique
字段1: userId | 升序(1)
字段2: friendId | 升序(1)
✅勾选唯一索引
```

创建完成打钩：□

#### ✅ 索引 22/28

```
集合: friends
索引名称: userId_status_index
字段1: userId | 升序(1)
字段2: status | 升序(1)
```

创建完成打钩：□

---

### 1️⃣1️⃣ posts 集合（2 个索引）

#### ✅ 索引 23/28

```
集合: posts
索引名称: userId_createdAt_index
字段1: userId | 升序(1)
字段2: createdAt | 降序(-1)
```

创建完成打钩：□

#### ✅ 索引 24/28

```
集合: posts
索引名称: visibility_createdAt_index
字段1: visibility | 升序(1)
字段2: createdAt | 降序(-1)
```

创建完成打钩：□

---

### 1️⃣2️⃣ orders 集合（2 个索引）

#### ✅ 索引 25/28 ⭐⭐⭐⭐⭐

```
集合: orders
索引名称: orderNo_unique
字段1: orderNo | 升序(1)
✅勾选唯一索引
```

创建完成打钩：□

#### ✅ 索引 26/28

```
集合: orders
索引名称: userId_createdAt_index
字段1: userId | 升序(1)
字段2: createdAt | 降序(-1)
```

创建完成打钩：□

---

## 🎯 最后 2 个索引（高优先级）

### 追加 users 集合的索引

#### ✅ 索引 27/28

```
集合: user_sessions
索引名称: userId_index
字段1: userId | 升序(1)
```

创建完成打钩：□

#### ✅ 索引 28/32

```
集合: meals
索引名称: userId_index
字段1: userId | 升序(1)
```

创建完成打钩：□

---

### 🆕 meat_products 集合（4 个索引）⭐ 新增

#### ✅ 索引 29/32 ⭐⭐⭐⭐⭐ 最高优先级

```
集合: meat_products
索引名称: name_unique
字段1: name | 升序(1) | ✅勾选唯一索引
```

**说明**：
- 用于查询肉类产品（getMeatAlternatives功能）
- 确保肉类名称唯一，避免重复数据
- 支持快速查找

创建完成打钩：□

#### ✅ 索引 30/32 ⭐⭐⭐⭐ 高优先级

```
集合: meat_products
索引名称: category_subcategory_index
字段1: category | 升序(1)
字段2: subcategory | 升序(1)
```

**说明**：
- 用于分类统计（red_meat/poultry/seafood/processed_meat）
- 支持子分类查询（beef/pork/lamb/chicken等）
- 优化聚合查询性能

创建完成打钩：□

#### ✅ 索引 31/32 ⭐⭐⭐ 中优先级

```
集合: meat_products
索引名称: carbonFootprint_index
字段1: carbonFootprint | 降序(-1)
```

**说明**：
- 用于按碳足迹排序（高到低）
- 支持教育展示页面
- 可选索引，影响较小

创建完成打钩：□

#### ✅ 索引 32/32 ⭐⭐⭐ 中优先级

```
集合: meat_products
索引名称: status_index
字段1: status | 升序(1)
```

**说明**：
- 用于过滤活跃状态的肉类数据
- 支持数据管理
- 可选索引

创建完成打钩：□

---

## 📊 进度统计

创建完成后统计：

- users: □□□ (3 个)
- user_sessions: □□ (2 个)
- meals: □□□□ (4 个)
- daily_stats: □□□ (3 个)
- gardens: □ (1 个)
- ingredients: □□ (2 个)
- recipes: □ (1 个)
- sync_tasks: □□□ (3 个)
- platform_configs: □ (1 个)
- friends: □□ (2 个)
- posts: □□ (2 个)
- orders: □□ (2 个)
- **meat_products: □□□□ (4 个)** ⭐ 新增

**总进度**: \_\_\_/32

---

## ⏱️ 时间估算

- 每个索引约 30-60 秒
- 32 个索引 × 45 秒 ≈ **24 分钟**
- 如果只创建核心索引（前 13 个）≈ **10 分钟**
- meat_products 索引（4 个）≈ **3 分钟**

---

## 💡 操作技巧

### 加速创建的方法

1. **双屏操作**: 一个屏幕看文档，一个屏幕操作控制台
2. **复制粘贴**: 直接复制"索引名称"和"字段名"
3. **快捷键**:
   - Tab 键切换输入框
   - Enter 确认
4. **分批创建**:
   - 先创建最高优先级（⭐⭐⭐⭐⭐）
   - 休息一下
   - 再创建其他的

### 避免错误的要点

✅ **字段名要完全一致**（区分大小写）

- ✅ `userId` （正确）
- ❌ `userid` （错误）
- ❌ `UserId` （错误）

✅ **升序降序要正确**

- 升序：选择 1 或 ASC
- 降序：选择 -1 或 DESC

✅ **唯一索引要勾选**

- 带 `_unique` 结尾的都要勾选

---

## 🎯 优先级分配

### 第一批（必须，8 个，6 分钟）

1. openId_unique
2. userId_mealDate_index
3. userId_source_orderId_unique
4. userId_date_index
5. userId_date_unique
6. userId_unique (gardens)
7. orderNo_unique
8. **name_unique (meat_products)** ⭐ 新增

**完成这 8 个后，核心功能就可以正常使用了！**

### 第二批（建议，14 个，10 分钟）

9-22 号索引

### 第三批（可选，10 个，8 分钟）

23-32 号索引（含meat_products剩余3个索引）

---

## 📱 控制台快捷路径

```
https://console.cloud.tencent.com/tcb/db/collection/my-garden-app-env-4e0h762923be2f

↓ 点击集合名称

↓ 点击「索引管理」标签

↓ 点击「新建索引」

↓ 复制上面的配置填写

↓ 点击「确定」

↓ 完成！在上面打钩 ✅
```

---

## ✅ 验证索引创建成功

创建后，在索引管理页面应该看到：

**users 集合示例**：

```
✓ _id_                    (系统默认)
✓ _openid_                (系统默认，可能有)
✓ openId_unique           (您创建的) ← 新增
✓ level_points_ranking    (您创建的) ← 新增
✓ lastLoginAt_index       (您创建的) ← 新增
```

---

**开始时间**: ****\_\_\_\_****  
**完成时间**: ****\_\_\_\_****  
**总耗时**: ****\_\_\_\_****

---

**文档版本**: v1.1  
**创建日期**: 2025-01-11  
**更新日期**: 2025-10-14  
**目标**: 快速完成 32 个索引创建（含meat_products集合4个索引）
