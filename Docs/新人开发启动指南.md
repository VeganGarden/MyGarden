# 新人开发启动指南

欢迎加入"我的花园"小程序开发团队！本指南将帮助您快速搭建开发环境并开始工作。

---

## 📋 目录

1. [环境准备](#1-环境准备)
2. [获取代码](#2-获取代码)
3. [本地开发环境搭建](#3-本地开发环境搭建)
4. [云开发环境配置](#4-云开发环境配置)
5. [数据库初始化](#5-数据库初始化)
6. [开发调试](#6-开发调试)
7. [团队协作流程](#7-团队协作流程)
8. [常见问题](#8-常见问题)
9. [项目负责人操作指南](#9-项目负责人操作指南) ⭐
10. [重要文档索引](#10-重要文档索引)
11. [项目架构速览](#11-项目架构速览)
12. [开发规范](#12-开发规范)
13. [联系方式](#13-联系方式)
14. [检查清单](#14-检查清单)
15. [下一步](#15-下一步)
16. [快速参考](#16-快速参考)

---

## 1. 环境准备

### 1.1 必需软件

请确保安装以下软件（点击查看安装指南）：

| 软件           | 版本要求       | 用途                | 下载地址                                                                |
| -------------- | -------------- | ------------------- | ----------------------------------------------------------------------- |
| Node.js        | >= 14.0.0      | JavaScript 运行环境 | https://nodejs.org/                                                     |
| Git            | 最新版         | 代码版本管理        | https://git-scm.com/                                                    |
| 微信开发者工具 | 最新稳定版     | 小程序调试          | https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html |
| VS Code        | 最新版（推荐） | 代码编辑器          | https://code.visualstudio.com/                                          |

### 1.2 VS Code 推荐插件

安装以下插件提升开发效率：

- **ESLint** - 代码检查
- **Prettier** - 代码格式化
- **Tauri Helper** - Taro 框架支持
- **GitLens** - Git 增强
- **Chinese (Simplified)** - 中文语言包

### 1.3 验证安装

打开终端，执行以下命令验证安装：

```bash
# 检查 Node.js 版本（应该 >= 14.0.0）
node --version

# 检查 npm 版本
npm --version

# 检查 Git 版本
git --version
```

**预期输出示例：**

```
v16.20.0
8.19.4
git version 2.39.0
```

---

## 2. 获取代码

### 2.1 配置 Git

首次使用需要配置 Git 用户信息：

```bash
# 配置用户名（使用你的真实姓名）
git config --global user.name "你的姓名"

# 配置邮箱（使用你的工作邮箱）
git config --global user.email "your.email@example.com"

# 验证配置
git config --global --list
```

### 2.2 克隆项目

```bash
# 克隆项目到本地
git clone https://github.com/VeganGarden/MyGarden.git

# 进入项目目录
cd MyGarden

# 查看分支
git branch -a
```

### 2.3 切换到开发分支

```bash
# 切换到 develop 分支（日常开发分支）
git checkout develop

# 拉取最新代码
git pull origin develop
```

---

## 3. 本地开发环境搭建

### 3.1 安装项目依赖

```bash
# 在项目根目录执行
npm install

# 等待安装完成（首次可能需要5-10分钟）
```

**如果遇到安装慢的问题：**

```bash
# 使用淘宝镜像
npm config set registry https://registry.npmmirror.com

# 重新安装
npm install
```

### 3.2 安装 CloudBase CLI

```bash
# 全局安装腾讯云开发CLI工具
npm install -g @cloudbase/cli

# 验证安装
tcb --version
```

### 3.3 配置环境变量

1. 在项目根目录创建 `.env` 文件：

```bash
touch .env
```

2. 复制以下内容到 `.env` 文件（**向团队管理员索取实际配置**）：

```env
# 腾讯云开发环境配置
CLOUDBASE_ENVID=my-garden-app-env-4e0h762923be2f
CLOUDBASE_REGION=ap-shanghai

# 微信小程序配置（向管理员索取）
WECHAT_APPID=你的AppID
WECHAT_SECRET=你的AppSecret
```

⚠️ **重要提示**：

- `.env` 文件已在 `.gitignore` 中，不会被提交到 Git
- 切勿将密钥信息分享给他人或提交到代码仓库

---

## 4. 云开发环境配置

### 4.1 登录腾讯云

⚠️ **重要说明**：

腾讯云环境由项目负责人创建并管理，新成员需要通过**协作者**方式访问。每个人使用自己的微信账号登录，不共享账号密码。

#### 首次加入团队（3步完成）

**步骤1：申请访问权限**

向项目负责人（或技术负责人）申请加入云开发环境：

- 提供你的**微信号**或**手机号**
- 说明需要的权限级别（一般为"开发者"权限即可）

**步骤2：等待并接受邀请**

项目负责人会在腾讯云开发控制台添加你为协作者，你会收到以下通知之一：

- 微信通知："您被邀请加入云开发环境"
- 短信通知（如果使用手机号邀请）

收到通知后：
1. 点击通知中的链接
2. 使用你的微信扫码登录腾讯云
3. 点击"接受邀请"

**步骤3：验证访问**

在你的开发电脑上执行：

```bash
# 登录腾讯云（会打开浏览器进行授权）
tcb login
```

按照提示完成微信扫码登录（使用你自己的微信）。

登录成功后，验证是否能访问项目环境：

```bash
# 查看云环境列表
tcb env list

# 应该能看到：my-garden-app-env-4e0h762923be2f
```

如果能看到环境，说明访问配置成功！

#### 如果没有收到邀请

请检查以下事项：

- [ ] 微信号/手机号是否提供正确
- [ ] 微信通知是否被屏蔽（检查微信设置）
- [ ] 联系项目负责人确认是否已发送邀请

#### 权限说明

根据你的角色，你可能拥有以下权限之一：

**开发者权限**（推荐给大部分团队成员）：
- ✅ 部署和调试云函数
- ✅ 查看数据库（读写）
- ✅ 查看运行日志
- ✅ 调用云函数测试
- ❌ 删除云环境
- ❌ 修改计费设置
- ❌ 添加其他协作者

**管理员权限**（仅核心成员）：
- ✅ 所有开发者权限
- ✅ 添加/移除协作者
- ✅ 修改环境配置
- ✅ 管理数据库索引
- ❌ 删除云环境（仅主账号可删除）

**只读权限**（观察者/实习生）：
- ✅ 查看云函数代码
- ✅ 查看日志
- ❌ 部署云函数
- ❌ 修改数据库

#### 安全注意事项

🔐 **账号安全**：
- 使用你自己的微信登录，不要共享账号
- 定期检查登录设备列表
- 发现异常及时联系管理员

⚠️ **操作规范**：
- 不要删除生产环境数据
- 部署前先在测试环境验证
- 重要操作前与团队沟通

📊 **可追溯性**：
- 所有操作都会记录操作人信息
- 便于问题排查和审计

### 4.2 验证云环境

```bash
# 查看云环境列表
tcb env list

# 应该能看到：my-garden-app-env-4e0h762923be2f
```

### 4.3 查看现有云函数

```bash
# 查看已部署的云函数
tcb fn list

# 应该能看到：
# - login (用户登录)
# - user (用户管理)
# - garden (花园管理)
# - carbon (碳足迹计算)
# - database (数据库初始化)
# - data-import (食材数据导入)
```

---

## 5. 数据库初始化

⚠️ **注意**：如果是加入已有项目，数据库应该已经初始化完成。以下步骤仅供参考或在需要重置数据库时使用。

### 5.1 检查数据库状态

1. 访问腾讯云开发控制台：https://console.cloud.tencent.com/tcb
2. 选择环境：`my-garden-app-env-4e0h762923be2f`
3. 进入"数据库"模块
4. 检查是否存在以下集合：

```
✅ users          - 用户信息（应该有数据）
✅ gardens        - 花园信息
✅ plants         - 植物实例
✅ plant_templates- 植物模板
✅ meals          - 用餐记录
✅ ingredients    - 食材库（应该有190条数据）
✅ recipes        - 食谱库
✅ daily_stats    - 每日统计
✅ achievements   - 成就系统
✅ notifications  - 通知消息
✅ feedback       - 用户反馈
✅ sync_logs      - 同步日志
```

### 5.2 如果需要重新初始化

**仅在团队负责人指导下执行！**

```bash
# 1. 部署database云函数
tcb fn deploy database --force

# 2. 在云开发控制台测试执行
# 控制台 → 云函数 → database → 测试
# 输入：{}
```

详细步骤参考：`Docs/数据库初始化部署指南.md`

---

## 6. 开发调试

### 6.1 启动开发服务器

```bash
# 在项目根目录执行
npm run dev:weapp

# 等待编译完成
# 看到 "Watching..." 表示编译成功
```

### 6.2 打开微信开发者工具

1. 打开微信开发者工具
2. 选择"导入项目"
3. 项目目录选择：`项目根目录/dist`
4. AppID：**向管理员索取**
5. 项目名称：我的花园

### 6.3 开发调试流程

```
1. 修改代码（src/目录）
   ↓
2. 保存文件（自动编译）
   ↓
3. 微信开发者工具自动刷新
   ↓
4. 查看效果
   ↓
5. 调试工具查看日志
```

### 6.4 常用开发命令

```bash
# 开发模式（微信小程序）
npm run dev:weapp

# 编译生产版本
npm run build:weapp

# 代码检查
npm run lint

# 类型检查
npm run type-check
```

---

## 7. 团队协作流程

### 7.1 Git 工作流

我们使用 **Git Flow** 工作流：

```
main 分支（稳定版）
  ↑
  合并（发布时）
  ↓
develop 分支（开发版）← 你的日常工作分支
  ↑
  合并（功能完成）
  ↓
feature/xxx 分支（功能分支）← 开发新功能时创建
```

### 7.2 开发新功能的标准流程

#### 步骤 1：创建功能分支

```bash
# 确保在 develop 分支
git checkout develop

# 拉取最新代码
git pull origin develop

# 创建功能分支（命名规范：feature/功能名称）
git checkout -b feature/your-feature-name

# 例如：开发用户头像上传功能
git checkout -b feature/user-avatar-upload
```

#### 步骤 2：开发功能

```bash
# 1. 编写代码
# 2. 测试功能
# 3. 本地验证通过
```

#### 步骤 3：提交代码

```bash
# 查看修改的文件
git status

# 添加修改的文件
git add .

# 提交（使用规范的commit message）
git commit -m "feat: 添加用户头像上传功能"
```

**Commit Message 规范：**

| 类型     | 说明      | 示例                         |
| -------- | --------- | ---------------------------- |
| feat     | 新功能    | `feat: 添加碳足迹图表展示`   |
| fix      | 修复 bug  | `fix: 修复登录页面跳转问题`  |
| docs     | 文档更新  | `docs: 更新API文档`          |
| style    | 代码格式  | `style: 统一代码缩进格式`    |
| refactor | 重构      | `refactor: 重构用户信息模块` |
| test     | 测试      | `test: 添加单元测试`         |
| chore    | 构建/工具 | `chore: 更新依赖包版本`      |

#### 步骤 4：推送到远程

```bash
# 推送功能分支到远程
git push origin feature/your-feature-name
```

#### 步骤 5：创建 Pull Request

1. 访问 GitHub 仓库：https://github.com/VeganGarden/MyGarden
2. 点击 "Pull requests" → "New pull request"
3. 选择：`develop` ← `feature/your-feature-name`
4. 填写 PR 描述：
   - 功能说明
   - 测试情况
   - 截图（如果有 UI 变化）
5. 指定审核人（团队负责人）
6. 提交 PR

#### 步骤 6：代码审核

- 等待团队成员审核
- 根据反馈修改代码
- 审核通过后，合并到 develop 分支

#### 步骤 7：清理分支

```bash
# 合并后，删除本地功能分支
git branch -d feature/your-feature-name

# 删除远程功能分支
git push origin --delete feature/your-feature-name

# 切回 develop 分支
git checkout develop

# 拉取最新代码（包含你的功能）
git pull origin develop
```

### 7.3 日常同步代码

```bash
# 每天开始工作前
git checkout develop
git pull origin develop

# 如果有冲突，解决后：
git add .
git commit -m "merge: 合并远程最新代码"
```

---

## 8. 常见问题

### Q1: npm install 很慢或失败

**解决方案：**

```bash
# 方案1：使用淘宝镜像
npm config set registry https://registry.npmmirror.com
npm install

# 方案2：使用 cnpm
npm install -g cnpm --registry=https://registry.npmmirror.com
cnpm install

# 方案3：删除 node_modules 重新安装
rm -rf node_modules package-lock.json
npm install
```

### Q2: 微信开发者工具提示 AppID 错误

**解决方案：**

- 向团队管理员索取正确的 AppID
- 在微信开发者工具中重新设置 AppID

### Q3: 云函数调用失败

**排查步骤：**

1. 检查云环境是否正确

```bash
tcb env list
```

2. 检查云函数是否部署

```bash
tcb fn list
```

3. 查看云函数日志

- 云开发控制台 → 云函数 → 选择函数 → 日志

### Q4: 编译报错

**常见原因和解决：**

```bash
# 1. 依赖问题
rm -rf node_modules
npm install

# 2. 缓存问题
npm run clean
npm run dev:weapp

# 3. TypeScript 类型错误
# 查看错误信息，修复类型定义
```

### Q5: Git 推送被拒绝

**原因**：远程有更新，需要先拉取

```bash
# 拉取并合并
git pull origin develop

# 如有冲突，解决后
git add .
git commit -m "merge: 合并冲突"
git push origin feature/your-branch
```

### Q6: 找不到某个文件或模块

**检查清单：**

- [ ] 文件路径是否正确
- [ ] 是否在正确的分支
- [ ] 是否执行了 `git pull`
- [ ] 是否执行了 `npm install`

### Q7: 数据库没有数据

**解决方案：**

- 检查是否连接了正确的云环境
- 联系管理员确认数据库状态
- 如需测试数据，执行食材数据导入

### Q8: 收到协作者邀请但无法接受

**可能原因和解决方案：**

1. **微信未绑定腾讯云**
   - 首次使用需要注册腾讯云账号
   - 点击邀请链接会自动引导注册

2. **邀请链接已过期**
   - 联系项目负责人重新发送邀请

3. **权限问题**
   - 确认邀请发送到了正确的微信号/手机号
   - 联系项目负责人确认权限设置

---

## 9. 项目负责人操作指南

> 📌 **本章节专为项目负责人准备**，指导如何添加和管理团队成员的云环境访问权限。

### 9.1 添加新成员为协作者

#### 方式1：通过云开发控制台（推荐）⭐

**步骤1：进入用户管理**

1. 登录腾讯云开发控制台：https://console.cloud.tencent.com/tcb
2. 选择环境：`my-garden-app-env-4e0h762923be2f`
3. 左侧菜单找到 **"用户管理"** 或 **"成员管理"**（不同版本名称可能不同）

**步骤2：添加成员**

1. 点击 **"添加成员"** 或 **"邀请协作者"** 按钮
2. 填写成员信息：
   - **微信号** 或 **手机号**（推荐使用微信号）
   - 备注名称（可选，如"张三-前端开发"）
3. 选择权限级别：
   
   | 权限 | 适用人员 | 推荐场景 |
   |------|----------|----------|
   | **管理员** | 核心开发者、技术负责人 | 需要管理其他成员、修改环境配置 |
   | **开发者** | 一般开发者 | 大部分团队成员（推荐） |
   | **只读** | 实习生、观察者 | 仅需查看代码和日志 |

4. 点击 **"确定"** 发送邀请

**步骤3：确认发送**

- 系统会向成员发送微信通知或短信
- 在"成员列表"中可以看到成员状态：
  - **待接受** - 邀请已发送，等待接受
  - **已加入** - 成员已接受邀请

#### 方式2：通过 CAM 访问管理（高级）

如需更精细的权限控制，可以使用访问管理（CAM）创建子账号：

1. 访问：https://console.cloud.tencent.com/cam
2. 创建子用户
3. 分配云开发权限：`QcloudTCBFullAccess` 或 `QcloudTCBReadOnlyAccess`
4. 提供子账号登录信息给团队成员

### 9.2 管理现有协作者

#### 查看协作者列表

控制台 → 云开发 → 用户管理 → 成员列表

可以看到：
- 成员列表
- 权限级别
- 加入时间
- 最后活跃时间

#### 修改成员权限

1. 在成员列表中找到目标成员
2. 点击 **"修改权限"**
3. 选择新的权限级别
4. 保存

#### 移除成员

当成员离职或不再需要访问时：

1. 在成员列表中找到目标成员
2. 点击 **"移除"** 或 **"删除"**
3. 确认操作

⚠️ **注意**：移除后，该成员立即失去环境访问权限。

### 9.3 权限配置建议

#### 推荐的权限分配

| 角色 | 人数建议 | 权限级别 | 说明 |
|------|----------|----------|------|
| 项目负责人 | 1人 | 主账号 | 您自己，拥有所有权限 |
| 技术负责人 | 1-2人 | 管理员 | 核心开发者，可管理成员 |
| 开发工程师 | 多人 | 开发者 | 日常开发人员 |
| 实习生/观察者 | 若干 | 只读 | 学习和观察 |

#### 安全建议

✅ **定期审查**：
- 每月审查一次成员列表
- 移除已离职人员
- 检查权限是否合理

✅ **最小权限原则**：
- 默认给"开发者"权限
- 确实需要时才给"管理员"权限
- 临时成员使用"只读"权限

✅ **操作审计**：
- 定期检查操作日志
- 关注异常操作
- 重要操作前团队沟通

### 9.4 常见管理问题

**Q: 成员说没收到邀请？**
- 确认微信号/手机号是否正确
- 检查成员微信通知是否开启
- 在控制台重新发送邀请

**Q: 成员权限不够用？**
- 在成员列表中修改权限级别
- 或联系腾讯云客服开通更多权限

**Q: 如何批量添加成员？**
- 目前只支持单个添加
- 建议使用脚本调用 CloudBase API（高级用法）

**Q: 协作者会产生费用吗？**
- 不会。协作者不额外收费
- 所有费用由主账号承担

### 9.5 成员接入检查清单

新成员加入时，确认以下事项：

**邀请前：**
- [ ] 确认成员的微信号/手机号
- [ ] 确定合适的权限级别
- [ ] 准备好项目说明材料

**邀请后：**
- [ ] 确认邀请已发送（控制台显示"待接受"）
- [ ] 通知成员查看微信通知
- [ ] 等待成员接受邀请

**接受后：**
- [ ] 成员状态变为"已加入"
- [ ] 成员能执行 `tcb env list` 看到环境
- [ ] 成员能正常部署云函数
- [ ] 添加成员到团队沟通群
- [ ] 分享新人开发启动指南

### 9.6 快速操作指南

```
添加新成员的5分钟流程：

1. 获取信息（1分钟）
   └─ 新人提供微信号

2. 发送邀请（2分钟）
   └─ 控制台 → 用户管理 → 添加成员
   └─ 输入微信号，选择"开发者"权限

3. 成员接受（1分钟）
   └─ 新人点击微信通知接受邀请

4. 验证访问（1分钟）
   └─ 新人执行：tcb login → tcb env list

✅ 完成！新成员可以开始开发工作
```

---

## 10. 重要文档索引

### 📚 必读文档

| 文档                                | 说明       | 优先级 |
| ----------------------------------- | ---------- | ------ |
| `README.md`                         | 项目简介   | ⭐⭐⭐ |
| `Docs/我的花园 -技术规格书.md`      | 技术架构   | ⭐⭐⭐ |
| `Docs/AI编码执行步骤文档.md`        | 开发进度   | ⭐⭐   |
| `Docs/数据库架构设计文档-简化版.md` | 数据库设计 | ⭐⭐⭐ |
| `Docs/结束分支开发工作流程.md`      | Git 流程   | ⭐⭐   |

### 🔧 参考文档

| 文档                                  | 说明         |
| ------------------------------------- | ------------ |
| `Docs/腾讯云开发环境配置指南.md`      | 云环境配置   |
| `Docs/数据库初始化部署指南.md`        | 数据库初始化 |
| `Docs/食材初始化数据导入-完成总结.md` | 食材数据     |
| `Docs/索引配置表.csv`                 | 数据库索引   |

---

## 11. 项目架构速览

### 技术栈

```
前端：Taro 3.6 + React 18 + TypeScript
后端：腾讯云开发 (CloudBase)
数据库：MongoDB
UI：Taro UI + SCSS
```

### 目录结构

```
MyGarden/
├── src/                    # 源代码
│   ├── pages/             # 页面
│   │   ├── index/        # 首页
│   │   ├── garden/       # 花园页
│   │   ├── carbon/       # 碳足迹页
│   │   ├── profile/      # 个人中心
│   │   └── login/        # 登录页
│   ├── components/        # 组件
│   ├── utils/            # 工具函数
│   └── types/            # 类型定义
├── cloudfunctions/        # 云函数
│   ├── login/            # 登录
│   ├── user/             # 用户管理
│   ├── garden/           # 花园管理
│   ├── carbon/           # 碳足迹计算
│   ├── database/         # 数据库初始化
│   └── data-import/      # 数据导入
├── Docs/                  # 文档
└── dist/                  # 编译输出（微信开发者工具打开此目录）
```

### 核心功能模块

1. **用户系统** - 微信登录、用户信息管理
2. **花园系统** - 虚拟花园、植物管理
3. **碳足迹** - 饮食记录、碳排放计算
4. **成就系统** - 积分、等级、徽章

---

## 12. 开发规范

### 12.1 代码规范

- **命名规范**：

  - 组件：PascalCase（如 `UserProfile.tsx`）
  - 函数/变量：camelCase（如 `getUserInfo`）
  - 常量：UPPER_SNAKE_CASE（如 `MAX_RETRY_COUNT`）
  - 文件名：kebab-case（如 `user-profile.tsx`）

- **注释规范**：
  - 复杂逻辑必须添加注释
  - 函数添加 JSDoc 注释
  - TODO/FIXME 标记待完成/待修复的代码

### 12.2 样式规范

- 使用 SCSS
- 使用 CSS Modules 避免样式冲突
- 遵循 BEM 命名规范

### 12.3 API 调用规范

```typescript
// 统一使用 utils/cloudbase.ts 中的封装函数
import { callCloudFunction } from "@/utils/cloudbase";

// 调用云函数
const result = await callCloudFunction("user", {
  action: "getProfile",
  userId: "xxx",
});
```

---

## 13. 联系方式

### 遇到问题？

1. **查看文档** - 先查阅项目文档
2. **搜索记录** - 查看 GitHub Issues
3. **询问团队** - 在团队群里提问
4. **创建 Issue** - 在 GitHub 上创建 Issue

### 团队沟通渠道

- **项目仓库**: https://github.com/VeganGarden/MyGarden
- **团队群**: [向管理员索取]
- **技术负责人**: [联系方式]
- **项目管理**: [联系方式]

---

## 14. 检查清单

开始开发前，请确认以下事项：

- [ ] Node.js 已安装（>= 14.0.0）
- [ ] Git 已配置（用户名和邮箱）
- [ ] 微信开发者工具已安装
- [ ] 项目代码已克隆
- [ ] 依赖已安装（npm install）
- [ ] CloudBase CLI 已安装
- [ ] 云环境已登录
- [ ] .env 文件已配置
- [ ] 开发服务器可以启动
- [ ] 微信开发者工具可以打开项目
- [ ] 已阅读主要文档
- [ ] 了解 Git 工作流程
- [ ] 已加入团队沟通群

---

## 15. 下一步

✅ 完成环境搭建后，建议：

1. **熟悉代码结构** - 浏览 `src/` 目录，了解各模块功能
2. **运行项目** - 在微信开发者工具中查看效果
3. **阅读技术规格书** - 了解技术架构和设计思路
4. **选择任务** - 从简单的任务开始（如 UI 调整、文档完善）
5. **创建第一个 PR** - 练习完整的开发流程

---

## 16. 快速参考

### 常用命令速查

```bash
# 开发
npm run dev:weapp          # 启动开发服务器
npm run build:weapp        # 编译生产版本

# Git
git status                 # 查看状态
git pull origin develop    # 拉取最新代码
git checkout -b feature/xxx # 创建功能分支
git add .                  # 暂存所有修改
git commit -m "message"    # 提交
git push origin xxx        # 推送

# 云开发
tcb login                  # 登录
tcb env list              # 查看环境
tcb fn list               # 查看云函数
tcb fn deploy xxx         # 部署云函数
```

### 关键链接

- GitHub 仓库: https://github.com/VeganGarden/MyGarden
- 腾讯云控制台: https://console.cloud.tencent.com/tcb
- 微信公众平台: https://mp.weixin.qq.com/
- Taro 文档: https://taro-docs.jd.com/

---

**欢迎加入团队！祝开发愉快！** 🎉

如有任何问题，随时在团队群里提问。

---

**版本**: v1.0.0  
**最后更新**: 2025-10-13  
**维护者**: MyGarden Team
