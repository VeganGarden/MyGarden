# v3.0 升级 - 下一步行动清单

> **当前状态**: ✅ 数据库升级完成 (集合+字段) | ⏳ 索引配置待完成  
> **更新时间**: 2025-10-15

---

## 🎉 已完成工作回顾

### ✅ Phase 1: 基础融合 (已完成)

1. **云函数开发和部署** ✅

   - [x] 创建 init-collections-v3.js
   - [x] 创建 migrate-collections-v3.js
   - [x] 更新 index.js 主入口
   - [x] 部署到云端

2. **数据库集合创建** ✅

   - [x] 创建 9 个 v3.0 新集合
   - [x] 扩展 7 个现有集合字段
   - [x] 验证版本: v3.0 ✅

3. **云函数准备** ✅

   - [x] product-recommend (商品推荐)
   - [x] order-sync (订单同步)
   - [x] product-data-import (商品导入)

4. **文档准备** ✅

   - [x] 完整架构方案 (17000+字)
   - [x] 执行指南
   - [x] 索引配置文档
   - [x] 完成报告

5. **示例数据** ✅
   - [x] 5 个示例商品数据

---

## 🔴 紧急任务 (今天必做)

### 任务 1: 配置 P0 核心索引 (7 个)

**重要性**: ⭐⭐⭐⭐⭐ (必须,保证数据完整性)  
**预计时间**: 30 分钟  
**负责人**: ****\_\_\_\_****

#### 操作步骤

1. **登录云开发控制台**

   ```
   https://console.cloud.tencent.com/tcb
   选择环境: my-garden-app-env-4e0h762923be2f
   ```

2. **创建索引** (按顺序)

   **索引 1**: products 集合

   ```
   字段: productId
   排序: 升序 (1)
   ✅ 勾选"唯一索引"
   ```

   **索引 2**: shopping_cart 集合

   ```
   字段: userId
   排序: 升序 (1)
   ✅ 勾选"唯一索引"
   ```

   **索引 3**: inventory 集合

   ```
   字段: productId, specId (复合索引)
   排序: 升序 (1), 升序 (1)
   ✅ 勾选"唯一索引"
   ```

   **索引 4**: promotions 集合

   ```
   字段: promotionId
   排序: 升序 (1)
   ✅ 勾选"唯一索引"
   ```

   **索引 5**: coupons 集合

   ```
   字段: couponId
   排序: 升序 (1)
   ✅ 勾选"唯一索引"
   ```

   **索引 6**: user_coupons 集合

   ```
   字段: code
   排序: 升序 (1)
   ✅ 勾选"唯一索引"
   ```

   **索引 7**: business_rules 集合

   ```
   字段: ruleId
   排序: 升序 (1)
   ✅ 勾选"唯一索引"
   ```

3. **验证索引创建**
   - 在"索引管理"页面查看已创建的索引
   - 确认显示"唯一索引"标识

#### 参考文档

- **详细说明**: `Docs/索引创建-复制粘贴版v3.0.md`
- **CSV 表格**: `Docs/索引配置表v3.0.csv`

---

## 🟡 重要任务 (本周完成)

### 任务 2: 配置 P1 常用索引 (28 个)

**重要性**: ⭐⭐⭐⭐  
**预计时间**: 1-2 小时  
**负责人**: ****\_\_\_\_****

按照 `Docs/索引创建-复制粘贴版v3.0.md` 中的表格逐个创建。

### 任务 3: 部署新云函数

```bash
# 商品推荐
tcb fn deploy product-recommend --dir ./cloudfunctions/product-recommend

# 订单同步
tcb fn deploy order-sync --dir ./cloudfunctions/order-sync

# 商品数据导入
tcb fn deploy product-data-import --dir ./cloudfunctions/product-data-import
```

### 任务 4: 导入示例商品数据

```bash
# 导入5个示例商品
tcb fn invoke product-data-import --params '{"mode":"sample"}'
```

### 任务 5: 功能测试

```bash
# 测试商品推荐
tcb fn invoke product-recommend --params '{"userId":"用户ID","scene":"home"}'

# 测试查询商品
# 在云开发控制台执行:
db.collection('products').limit(5).get()
```

---

## 🟢 优化任务 (本月完成)

### 任务 6: 准备九悦实际数据

1. **导出九悦现有数据**

   - 商品列表 (CSV/Excel)
   - 历史订单 (CSV/Excel)
   - 用户信息 (CSV/Excel)

2. **数据清洗和格式化**

   - 转换为 products 集合格式
   - 建立商品-食材关联关系
   - 添加中医属性和节气标签

3. **批量导入**
   - 使用 product-data-import 云函数
   - 分批导入 (每批 50-100 个商品)

### 任务 7: 开发商城小程序页面

1. **商品列表页**

   - 多维度筛选 (体质/节气/品类)
   - 商品卡片展示
   - 践行者认证标识

2. **商品详情页**

   - 基本信息展示
   - 践行者证言
   - 中医属性说明
   - 一键加购物车

3. **购物车页**

   - 商品列表
   - 体质适配提示
   - 积分抵扣
   - 结算

4. **订单页**
   - 订单列表
   - 订单详情
   - 碳足迹展示
   - 同步到花园提示

### 任务 8: 数据打通测试

1. **测试订单同步**

   - 创建测试订单
   - 验证自动同步到 meals
   - 验证积分增加
   - 验证碳足迹计算

2. **测试商品推荐**

   - 体质匹配推荐
   - 节气推荐
   - 个性化推荐

3. **测试积分互通**
   - 花园积分使用
   - 商城积分获得
   - 积分转换

---

## 📅 时间规划

### 本周 (10 月 15-20 日)

| 日期           | 任务                 | 负责人 | 状态   |
| -------------- | -------------------- | ------ | ------ |
| 10 月 15 日    | 配置 P0 索引 (7 个)  | -      | ⏳     |
| 10 月 16-17 日 | 配置 P1 索引 (28 个) | -      | 待开始 |
| 10 月 18 日    | 部署新云函数         | -      | 待开始 |
| 10 月 19 日    | 导入示例数据         | -      | 待开始 |
| 10 月 20 日    | 功能测试             | -      | 待开始 |

### 本月 (10 月 21-31 日)

| 周      | 任务               | 交付物           |
| ------- | ------------------ | ---------------- |
| 第 3 周 | 九悦数据准备和导入 | 商品数据导入完成 |
| 第 4 周 | 商城小程序开发     | 基础页面完成     |

### 下月 (11 月)

| 周        | 任务             | 交付物           |
| --------- | ---------------- | ---------------- |
| 第 1-2 周 | 数据打通功能开发 | 订单同步功能     |
| 第 3-4 周 | 测试和优化       | v3.0 Beta 版上线 |

---

## ✅ 验收标准

### Phase 1 验收 (本周)

- [ ] 37 个索引全部创建完成
- [ ] 3 个新云函数部署成功
- [ ] 5 个示例商品导入成功
- [ ] 商品推荐功能测试通过

### Phase 2 验收 (本月)

- [ ] 九悦实际商品数据导入 (100+个)
- [ ] 商城小程序基础功能完成
- [ ] 订单同步功能测试通过

### Phase 3 验收 (2 个月)

- [ ] 数据打通功能全部上线
- [ ] 用户测试反馈良好
- [ ] 核心指标达成:
  - 推荐点击率 > 15%
  - 订单同步成功率 > 95%
  - 用户留存率 > 50%

---

## 🎯 关键成功因素

1. **索引配置及时** - 保证查询性能
2. **数据质量高** - 商品数据完整准确
3. **功能测试充分** - 避免线上问题
4. **用户引导清晰** - 让用户理解融合价值

---

## 📞 遇到问题?

### 技术问题

- 查看: `数据库v3.0升级-执行指南.md`
- 查看: `Docs/数据库架构升级方案v3.0-九悦融合版.md`

### 索引配置问题

- 查看: `Docs/索引创建-复制粘贴版v3.0.md`
- CSV 表: `Docs/索引配置表v3.0.csv`

### 业务对接问题

- 查看: `数据库v3.0升级-执行摘要.md`

---

## 💪 Let's Go!

**数据库已就绪,现在就开始配置索引,开启素食生态闭环的新篇章!**

**第一步**: 打开云开发控制台,配置 7 个 P0 核心索引  
**第二步**: 部署新云函数,导入示例数据  
**第三步**: 测试功能,验证数据打通

**目标**: 本周完成 Phase 1,下月上线商城功能!

---

**清单负责人**: ****\_\_\_\_****  
**日期**: 2025-10-15  
**签字**: ****\_\_\_\_****
