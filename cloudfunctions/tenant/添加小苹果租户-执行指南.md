# 添加"小苹果"租户到数据库 - 执行指南

## 方法 1：通过云函数调用（推荐）

### 步骤 1：部署云函数

1. 确保 `tenant` 云函数已部署到腾讯云开发
2. 如果未部署，执行：
   ```bash
   cd cloudfunctions/tenant
   npm install
   # 在云开发控制台部署云函数
   ```

### 步骤 2：调用云函数

在腾讯云开发控制台：

1. 进入"云函数" → 找到 `tenant` 函数
2. 点击"测试"或"在线调试"
3. 输入以下参数：
   ```json
   {
     "action": "addXiaopingguo"
   }
   ```
4. 点击"运行测试"
5. 查看执行结果，应该显示：
   ```json
   {
     "success": true,
     "message": "\"小苹果\"租户添加成功",
     "data": {
       "tenantId": "tenant_xiaopingguo",
       "tenantName": "小苹果",
       "restaurants": [...]
     }
   }
   ```

## 方法 2：在云开发控制台手动创建

### 步骤 1：创建租户

1. 进入腾讯云开发控制台 → 数据库 → `tenants` 集合
2. 点击"添加记录"
3. 输入以下数据：
   ```json
   {
     "_id": "tenant_xiaopingguo",
     "name": "小苹果",
     "contactName": "小苹果",
     "contactPhone": "13800138000",
     "contactEmail": "xiaopingguo@example.com",
     "status": "active",
     "createdAt": "2025-01-20T00:00:00.000Z",
     "updatedAt": "2025-01-20T00:00:00.000Z"
   }
   ```
4. 点击"保存"

### 步骤 2：创建餐厅 1 - 素开心

1. 进入 `restaurants` 集合
2. 点击"添加记录"
3. 输入以下数据：
   ```json
   {
     "_id": "restaurant_sukuaixin",
     "tenantId": "tenant_xiaopingguo",
     "name": "素开心",
     "address": "上海市虹桥区XX路123号",
     "phone": "021-12345678",
     "email": "sukuaixin@example.com",
     "status": "active",
     "certificationLevel": "gold",
     "certificationStatus": "certified",
     "createdAt": "2024-01-15T00:00:00.000Z",
     "updatedAt": "2025-01-20T00:00:00.000Z"
   }
   ```
4. 点击"保存"

### 步骤 3：创建餐厅 2 - 素欢乐

1. 在 `restaurants` 集合中再次点击"添加记录"
2. 输入以下数据：
   ```json
   {
     "_id": "restaurant_suhuanle",
     "tenantId": "tenant_xiaopingguo",
     "name": "素欢乐",
     "address": "上海市浦东新区XX街456号",
     "phone": "021-87654321",
     "email": "suhuanle@example.com",
     "status": "active",
     "certificationLevel": "silver",
     "certificationStatus": "certified",
     "createdAt": "2024-02-20T00:00:00.000Z",
     "updatedAt": "2025-01-20T00:00:00.000Z"
   }
   ```
3. 点击"保存"

## 方法 3：使用命令行（如果已配置云开发 CLI）

```bash
cd cloudfunctions/tenant
tcb fn invoke tenant --params '{"action":"addXiaopingguo"}'
```

## 验证数据

添加完成后，在云开发控制台验证：

1. **检查租户**：

   - 进入 `tenants` 集合
   - 应该能看到 `tenant_xiaopingguo` 记录

2. **检查餐厅**：
   - 进入 `restaurants` 集合
   - 应该能看到两条记录：
     - `restaurant_sukuaixin` (素开心)
     - `restaurant_suhuanle` (素欢乐)
   - 两条记录的 `tenantId` 都应该是 `tenant_xiaopingguo`

## 数据说明

### 租户信息

- **ID**: `tenant_xiaopingguo`
- **名称**: 小苹果
- **状态**: active（活跃）

### 餐厅信息

**餐厅 1：素开心**

- **ID**: `restaurant_sukuaixin`
- **名称**: 素开心
- **地址**: 上海市虹桥区 XX 路 123 号
- **认证等级**: gold（金牌）
- **认证状态**: certified（已认证）

**餐厅 2：素欢乐**

- **ID**: `restaurant_suhuanle`
- **名称**: 素欢乐
- **地址**: 上海市浦东新区 XX 街 456 号
- **认证等级**: silver（银牌）
- **认证状态**: certified（已认证）

## 注意事项

1. **幂等性**：脚本支持重复执行，如果数据已存在会更新，不存在会创建
2. **ID 冲突**：如果 `_id` 已存在，会更新现有记录
3. **关联关系**：确保餐厅的 `tenantId` 正确关联到租户 ID

## 故障排查

### 问题 1：云函数调用失败

**解决方案**：

- 检查云函数是否已正确部署
- 查看云函数日志，确认错误信息
- 确保数据库集合 `tenants` 和 `restaurants` 已创建

### 问题 2：数据未创建

**解决方案**：

- 检查数据库权限设置
- 确认集合名称正确（`tenants` 和 `restaurants`）
- 查看云函数执行日志

### 问题 3：ID 冲突

**解决方案**：

- 如果 `_id` 已存在，脚本会自动更新现有记录
- 如果想创建新记录，需要修改 `_id` 值

## 完成后的操作

数据添加成功后：

1. **刷新前端应用**：清除 localStorage 缓存
2. **重新登录**：使用"小苹果"账号登录
3. **验证功能**：检查个人中心、餐厅切换等功能是否正常

