# å°†"å°è‹¹æœ"ç§Ÿæˆ·æ•°æ®è¿ç§»åˆ°"apple"è´¦å· - æ‰§è¡ŒæŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æ­¤è„šæœ¬ç”¨äºå°†"å°è‹¹æœ"ç§Ÿæˆ·ä¸‹çš„æ‰€æœ‰èœè°±ç®¡ç†ç›¸å…³æ•°æ®è¿ç§»åˆ°"apple"è´¦å·ï¼Œå¹¶åˆ é™¤"å°è‹¹æœ"ç§Ÿæˆ·ã€‚

## âš ï¸ é‡è¦æç¤º

1. **æ•°æ®å¤‡ä»½**ï¼šåœ¨æ‰§è¡Œè¿ç§»å‰ï¼Œå»ºè®®å…ˆå¤‡ä»½ç›¸å…³æ•°æ®
2. **ä¸å¯é€†æ“ä½œ**ï¼šè¿ç§»å®Œæˆåï¼Œ"å°è‹¹æœ"ç§Ÿæˆ·å°†è¢«åˆ é™¤ï¼Œæ­¤æ“ä½œä¸å¯é€†
3. **æµ‹è¯•ç¯å¢ƒ**ï¼šå»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒæ‰§è¡Œï¼Œç¡®è®¤æ— è¯¯åå†åœ¨ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œ

## ğŸ¯ è¿ç§»å†…å®¹

### è¿ç§»çš„æ•°æ®ï¼š

- âœ… **recipes** é›†åˆï¼šæ‰€æœ‰å±äº"å°è‹¹æœ"ç§Ÿæˆ·çš„èœè°±æ•°æ®
- âœ… **restaurants** é›†åˆï¼šåˆ›å»ºå¯¹åº”çš„ç›®æ ‡é¤å…ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰

### è¿ç§»åçš„å˜åŒ–ï¼š

- èœè°±çš„ `tenantId` ä» `tenant_xiaopingguo` æ›´æ–°ä¸º `tenant_apple`
- èœè°±çš„ `restaurantId` æ›´æ–°ä¸ºå¯¹åº”çš„ç›®æ ‡é¤å… ID
- åˆ›å»º `tenant_apple` ç§Ÿæˆ·ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
- åˆ›å»ºå¯¹åº”çš„ç›®æ ‡é¤å…ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
- åˆ é™¤ `tenant_xiaopingguo` ç§Ÿæˆ·åŠå…¶é¤å…

## ğŸš€ æ‰§è¡Œæ­¥éª¤

### æ–¹æ³• 1ï¼šé€šè¿‡äº‘å¼€å‘æ§åˆ¶å°æ‰§è¡Œï¼ˆæ¨èï¼‰

1. **éƒ¨ç½²äº‘å‡½æ•°**

   ```bash
   cd cloudfunctions/tenant
   tcb fn deploy tenant --envId your-env-id
   ```

2. **åœ¨äº‘å¼€å‘æ§åˆ¶å°æ‰§è¡Œ**
   - æ‰“å¼€è…¾è®¯äº‘å¼€å‘æ§åˆ¶å°
   - è¿›å…¥ã€Œäº‘å‡½æ•°ã€ç®¡ç†
   - æ‰¾åˆ° `tenant` å‡½æ•°
   - ç‚¹å‡»ã€Œæµ‹è¯•ã€
   - è¾“å…¥æµ‹è¯•å‚æ•°ï¼š
     ```json
     {
       "action": "migrateXiaopingguoToApple"
     }
     ```
   - ç‚¹å‡»ã€Œè¿è¡Œæµ‹è¯•ã€
   - æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—

### æ–¹æ³• 2ï¼šé€šè¿‡å‘½ä»¤è¡Œæ‰§è¡Œ

```bash
cd cloudfunctions/tenant
tcb fn invoke tenant -e your-env-id --params '{"action":"migrateXiaopingguoToApple"}'
```

## ğŸ“Š æ‰§è¡Œç»“æœ

æˆåŠŸæ‰§è¡Œåï¼Œå°†è¿”å›ä»¥ä¸‹ä¿¡æ¯ï¼š

```json
{
  "success": true,
  "message": "è¿ç§»å®Œæˆ",
  "data": {
    "sourceTenantId": "tenant_xiaopingguo",
    "targetTenantId": "tenant_apple",
    "targetRestaurantIds": [
      "restaurant_apple_sukuaixin",
      "restaurant_apple_suhuanle"
    ],
    "migrationSummary": {
      "recipes": {
        "total": 100,
        "migrated": 100,
        "failed": 0
      }
    }
  }
}
```

## ğŸ” éªŒè¯è¿ç§»ç»“æœ

### 1. éªŒè¯ç›®æ ‡ç§Ÿæˆ·

åœ¨äº‘å¼€å‘æ§åˆ¶å°çš„æ•°æ®åº“ä¸­æŸ¥è¯¢ï¼š

```javascript
// æŸ¥è¯¢ç›®æ ‡ç§Ÿæˆ·
db.collection("tenants").doc("tenant_apple").get();
```

### 2. éªŒè¯èœè°±æ•°æ®

```javascript
// æŸ¥è¯¢è¿ç§»åçš„èœè°±
db.collection("recipes")
  .where({
    tenantId: "tenant_apple",
  })
  .get();
```

### 3. éªŒè¯æºç§Ÿæˆ·å·²åˆ é™¤

```javascript
// ç¡®è®¤æºç§Ÿæˆ·å·²åˆ é™¤ï¼ˆåº”è¯¥è¿”å›ç©ºï¼‰
db.collection("tenants").doc("tenant_xiaopingguo").get();
```

## âŒ é”™è¯¯å¤„ç†

å¦‚æœè¿ç§»è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼š

1. **æ£€æŸ¥æ—¥å¿—**ï¼šæŸ¥çœ‹äº‘å‡½æ•°æ‰§è¡Œæ—¥å¿—ï¼Œæ‰¾åˆ°å…·ä½“çš„é”™è¯¯ä¿¡æ¯
2. **æ•°æ®å›æ»š**ï¼šå¦‚æœè¿ç§»å¤±è´¥ï¼Œéœ€è¦æ‰‹åŠ¨æ¢å¤æ•°æ®
3. **é‡æ–°æ‰§è¡Œ**ï¼šä¿®å¤é—®é¢˜åï¼Œå¯ä»¥é‡æ–°æ‰§è¡Œè¿ç§»è„šæœ¬ï¼ˆè„šæœ¬æ”¯æŒå¹‚ç­‰æ“ä½œï¼‰

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **é¤å… ID æ˜ å°„è§„åˆ™**ï¼š

   - æºé¤å… IDï¼š`restaurant_sukuaixin` â†’ ç›®æ ‡é¤å… IDï¼š`restaurant_apple_sukuaixin`
   - æºé¤å… IDï¼š`restaurant_suhuanle` â†’ ç›®æ ‡é¤å… IDï¼š`restaurant_apple_suhuanle`

2. **æ•°æ®å®Œæ•´æ€§**ï¼š

   - è¿ç§»è„šæœ¬ä¼šä¿ç•™èœè°±çš„æ‰€æœ‰åŸå§‹æ•°æ®
   - åªæ›´æ–° `tenantId` å’Œ `restaurantId` å­—æ®µ
   - å…¶ä»–å­—æ®µä¿æŒä¸å˜

3. **æ‰¹é‡å¤„ç†**ï¼š
   - è„šæœ¬ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢ï¼Œæ¯æ¬¡å¤„ç† 100 æ¡è®°å½•
   - å¯¹äºå¤§é‡æ•°æ®ï¼Œè¿ç§»å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´

## ğŸ”„ å›æ»šæ–¹æ¡ˆ

å¦‚æœéœ€è¦å›æ»šè¿ç§»ï¼ˆå°†æ•°æ®ä»"apple"è¿å›"å°è‹¹æœ"ï¼‰ï¼Œå¯ä»¥ï¼š

1. é‡æ–°åˆ›å»º"å°è‹¹æœ"ç§Ÿæˆ·
2. åˆ›å»ºå¯¹åº”çš„é¤å…
3. æ‰§è¡Œåå‘è¿ç§»è„šæœ¬ï¼ˆéœ€è¦å•ç‹¬ç¼–å†™ï¼‰

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹äº‘å‡½æ•°æ‰§è¡Œæ—¥å¿—
2. æ£€æŸ¥æ•°æ®åº“é›†åˆæ˜¯å¦å­˜åœ¨
3. ç¡®è®¤æƒé™é…ç½®æ˜¯å¦æ­£ç¡®
