# 插入餐厅测试数据 - 使用指南

## 📋 功能说明

此脚本用于为"素开心"和"素欢乐"两家气候餐厅插入测试数据，包括：

1. **订单数据** (restaurant_orders)

   - 素开心：15 条订单
   - 素欢乐：12 条订单
   - 包含订单信息、碳足迹、支付信息等

2. **评价数据** (restaurant_reviews)

   - 素开心：10 条评价
   - 素欢乐：8 条评价
   - 包含评分、评论内容、碳满意度等

3. **优惠券数据** (restaurant_campaigns)

   - 素开心：5 个优惠券
   - 素欢乐：4 个优惠券
   - 包含折扣券、满减券等不同类型

4. **行为统计数据** (restaurant_behavior_metrics)
   - 每个餐厅：过去 30 天的每日统计数据
   - 包含低碳比例、碳减排量、客户行为等指标

## 🚀 执行步骤

### 方法一：云开发控制台

1. **进入云开发控制台**

   - 访问：https://console.cloud.tencent.com/tcb
   - 选择环境：`my-garden-app-env`

2. **打开云函数**

   - 点击左侧菜单「云函数」
   - 找到 `database` 函数

3. **调用云函数**

   - 点击「测试」按钮
   - 输入以下参数：

   ```json
   {
     "action": "insertRestaurantTestData"
   }
   ```

   - 点击「运行测试」

4. **查看结果**
   - 查看返回的 JSON 结果
   - 检查控制台日志，确认数据插入情况

### 方法二：命令行

```bash
# 在项目根目录执行
cd /Users/zhangshichao/WeChatProjects/MyGarden

# 调用云函数
tcb fn invoke database --params '{"action":"insertRestaurantTestData"}' --envId my-garden-app-env
```

## ✅ 预期结果

执行成功后，会返回类似以下的结果：

```json
{
  "code": 0,
  "message": "测试数据插入成功",
  "results": {
    "orders": {
      "sukuaixin": 15,
      "suhuanle": 12
    },
    "reviews": {
      "sukuaixin": 10,
      "suhuanle": 8
    },
    "campaigns": {
      "sukuaixin": 5,
      "suhuanle": 4
    },
    "behaviorMetrics": {
      "sukuaixin": 30,
      "suhuanle": 30
    }
  }
}
```

## 📊 数据说明

### 订单数据特点

- **时间范围**：过去 30 天内的随机时间
- **金额范围**：50-200 元（素开心），40-150 元（素欢乐）
- **碳足迹**：0.5-2.0 kg CO₂e
- **碳减排**：1.0-3.0 kg CO₂e
- **订单状态**：包含 pending、processing、completed、cancelled 等状态

### 评价数据特点

- **评分范围**：3-5 星
- **碳满意度**：3-5 分
- **回复率**：约 50%的评价有商家回复
- **评论内容**：包含对菜品、服务、环保理念等的评价

### 优惠券数据特点

- **类型**：折扣券（discount）、满减券（cash）
- **有效期**：30 天
- **使用情况**：包含总数量和已使用数量
- **状态**：根据有效期自动判断 active 或 expired

### 行为统计数据特点

- **统计周期**：每日数据
- **时间范围**：过去 30 天
- **指标包括**：
  - 低碳比例（lowCarbonRatio）
  - 月度碳减排量（monthlyCarbonReduction）
  - 客户低碳选择率（customerLowCarbonChoiceRate）
  - 行为记录数（behaviorRecordCount）
  - 订单数、营收、客单价等

## ⚠️ 注意事项

1. **餐厅必须存在**

   - 脚本会自动查找"素开心"和"素欢乐"餐厅
   - 如果餐厅不存在，会返回错误信息
   - 请确保餐厅已创建并正确命名

2. **数据可能重复**

   - 如果多次执行，可能会插入重复数据
   - 建议先清空测试数据，或检查数据是否已存在

3. **租户 ID**
   - 脚本会自动获取餐厅的 tenantId
   - 确保餐厅数据中包含正确的 tenantId

## 🔍 验证数据

插入完成后，可以在云开发控制台的数据库中查看：

1. **查看订单数据**

   ```
   数据库 → restaurant_orders → 数据管理
   筛选条件：restaurantName = "素开心" 或 "素欢乐"
   ```

2. **查看评价数据**

   ```
   数据库 → restaurant_reviews → 数据管理
   筛选条件：restaurantName = "素开心" 或 "素欢乐"
   ```

3. **查看优惠券数据**

   ```
   数据库 → restaurant_campaigns → 数据管理
   筛选条件：restaurantName = "素开心" 或 "素欢乐"
   ```

4. **查看行为统计数据**
   ```
   数据库 → restaurant_behavior_metrics → 数据管理
   筛选条件：restaurantName = "素开心" 或 "素欢乐"
   ```

## 🐛 故障排查

### 问题 1：找不到餐厅

**错误信息**：`未找到"素开心"或"素欢乐"餐厅`

**解决方法**：

- 检查餐厅是否已创建
- 确认餐厅名称完全匹配（"素开心"、"素欢乐"）
- 可以在数据库中查看 restaurants 集合

### 问题 2：插入失败

**错误信息**：`插入测试数据失败`

**解决方法**：

- 查看控制台日志，找到具体的错误信息
- 检查集合是否存在
- 确认字段格式是否正确

### 问题 3：数据重复

**解决方法**：

- 可以手动删除已插入的测试数据
- 或者在插入前添加检查逻辑

## 📝 后续操作

插入测试数据后，可以：

1. **在 Web 平台查看**

   - 登录管理后台
   - 切换到对应的餐厅
   - 查看订单、评价、优惠券、行为统计等页面

2. **测试功能**

   - 测试订单列表筛选
   - 测试评价回复功能
   - 测试优惠券管理
   - 测试数据报表生成

3. **验证数据展示**
   - 检查图表数据是否正确显示
   - 验证统计数据是否准确
   - 测试分页和筛选功能

## 📞 技术支持

如有问题，请查看：

- 云函数日志：云开发控制台 → 云函数 → database → 日志
- 数据库文档：`Docs/数据库集合总览.csv`
- 项目文档：`Docs/` 目录下的相关文档
