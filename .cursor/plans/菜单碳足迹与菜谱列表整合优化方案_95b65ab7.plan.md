---
name: 菜单碳足迹与菜谱列表整合优化方案
overview: 优化"菜单碳足迹"和"菜谱列表"两个页面的功能定位，明确各自职责，减少功能重复，提升用户体验。保持两个页面分离，但统一数据源，优化功能划分。
todos: []
---

# 菜单碳足迹与菜谱列表整合优化方案

## 一、现状分析

### 当前问题

1. **功能重叠**：两个页面都在管理同一个数据源（`restaurant_menu_items`集合），存在大量重复功能

- 列表展示（菜品名称、碳足迹信息）
- 编辑功能
- 删除功能
- 计算碳足迹功能

2. **功能定位不清晰**：

- `carbon/Menu.tsx`（菜单碳足迹）：位于"碳足迹核算"板块，但包含基础编辑、删除功能
- `recipe/List.tsx`（菜谱列表）：位于"菜谱管理"板块，但包含碳足迹计算功能

3. **用户体验问题**：

- 用户在两个地方管理同一批数据，容易混淆
- 功能分散，增加学习成本
- API调用不一致（`carbonFootprintAPI.getMenuList` vs `tenantAPI.getMenuList`）

### 数据源统一

两个页面都操作 `restaurant_menu_items` 集合，数据结构包含：

- 基础信息：name, description, price, category, status
- 碳足迹信息：carbonFootprint (value/baseline/reduction/breakdown), calculationLevel, baselineInfo, factorMatchInfo
- 配置信息：mealType, energyType, cookingMethod, cookingTime
- 关联信息：restaurantId, baseRecipeId, ingredients

## 二、优化方案

### 方案概述：保持分离，明确职责，统一数据源

#### 1. 功能重新划分

**菜谱列表（`recipe/List.tsx`）- 菜单运营管理**

- **定位**：餐厅菜单的日常运营管理，面向餐厅管理员
- **核心功能**：
- ✅ 菜单项基础管理：添加、编辑、删除、启用/停用
- ✅ 从基础菜谱库添加菜品到菜单
- ✅ 价格管理
- ✅ 分类管理
- ✅ 状态管理（可用/不可用）
- ✅ 搜索和筛选（按名称、分类、状态）
- **碳足迹相关功能**：
- ✅ 显示碳足迹三值（值、基准值、减排值）
- ✅ 显示计算级别标签
- ✅ 一键计算碳足迹（调用计算API）
- ✅ 编辑时设置计算参数（mealType, energyType, calculationLevel）
- **移除功能**：
- ❌ 批量导入（移至菜单碳足迹页面）
- ❌ 重新计算（移至菜单碳足迹页面）

**菜单碳足迹（`carbon/Menu.tsx`）- 碳足迹专项管理**

- **定位**：碳足迹数据的管理、分析和优化，面向碳足迹核算需求
- **核心功能**：
- ✅ 碳足迹数据展示和分析（三值对比、计算级别统计）
- ✅ 批量重新计算碳足迹
- ✅ 批量导入菜单碳足迹数据（Excel/CSV）
- ✅ 碳标签管理（批量设置、自动生成）
- ✅ 碳积分管理
- ✅ 碳足迹分析报告（趋势、对比、排名）
- ✅ 筛选和搜索（按碳标签、计算级别、减排值范围）
- **菜单管理功能**：
- ⚠️ 只读展示基本信息（名称、分类等）
- ❌ 不提供编辑、删除功能（跳转到菜谱列表）
- ✅ 提供快速跳转到菜谱列表编辑的链接

#### 2. 数据源统一

**统一使用 `tenantAPI.getMenuList`**

- 两个页面都使用相同的API获取数据
- 确保数据一致性
- 减少重复代码

**统一数据处理逻辑**

- 创建共享的数据转换函数
- 统一字段映射规则
- 统一错误处理

#### 3. 页面导航优化

**从菜谱列表跳转到菜单碳足迹**

- 在操作列添加"查看碳足迹详情"按钮
- 跳转时携带菜单项ID，在菜单碳足迹页面高亮显示

**从菜单碳足迹跳转到菜谱列表**

- 在操作列添加"编辑菜单项"按钮
- 跳转时携带菜单项ID，在菜谱列表页面打开编辑弹窗

## 三、实施计划

### 阶段一：数据源统一

1. **统一API调用**

- [ ] 修改 `carbon/Menu.tsx` 使用 `tenantAPI.getMenuList` 替代 `carbonFootprintAPI.getMenuList`
- [ ] 创建共享的数据转换函数（如 `transformMenuItemData`）
- [ ] 统一错误处理逻辑

2. **统一接口类型定义**

- [ ] 创建共享的 `MenuItem` 类型定义文件
- [ ] 两个页面都使用统一的类型定义

### 阶段二：功能重新分配

1. **优化菜谱列表页面（`recipe/List.tsx`）**

- [ ] 保持现有功能（添加、编辑、删除、从基础菜谱库添加）
- [ ] 保留显示碳足迹三值和计算级别
- [ ] 保留计算碳足迹功能
- [ ] 移除批量导入相关代码（如有）
- [ ] 移除重新计算功能（如有，改为跳转到菜单碳足迹页面）

2. **优化菜单碳足迹页面（`carbon/Menu.tsx`）**

- [ ] 移除基础编辑功能（编辑、删除按钮改为跳转到菜谱列表）
- [ ] 增强批量重新计算功能
- [ ] 完善批量导入功能
- [ ] 添加碳足迹分析功能（统计、对比、趋势）
- [ ] 添加按碳标签、计算级别、减排值范围筛选
- [ ] 添加快速跳转到菜谱列表编辑的链接

### 阶段三：用户体验优化

1. **页面导航**

- [ ] 在菜谱列表添加"查看碳足迹详情"按钮
- [ ] 在菜单碳足迹添加"编辑菜单项"按钮
- [ ] 实现页面间跳转并传递参数

2. **功能提示**

- [ ] 在菜谱列表添加提示："需要批量管理碳足迹？前往菜单碳足迹页面"
- [ ] 在菜单碳足迹添加提示："需要编辑菜单项？前往菜谱列表"

3. **数据一致性**

- [ ] 确保两个页面数据实时同步（使用相同的API和刷新机制）
- [ ] 在一个页面操作后，另一个页面能够及时更新

### 阶段四：代码优化

1. **提取共享组件**

- [ ] 创建共享的碳足迹显示组件（CarbonFootprintDisplay）
- [ ] 创建共享的计算级别标签组件（CalculationLevelTag）
- [ ] 创建共享的碳标签组件（CarbonLabelTag）

2. **提取共享工具函数**

- [ ] 数据转换函数
- [ ] 格式化函数（碳足迹值格式化、计算级别文本等）

3. **代码清理**

- [ ] 移除重复代码
- [ ] 统一代码风格
- [ ] 添加必要注释

## 四、文件修改清单

### 需要修改的文件

1. **`admin-web/src/pages/carbon/Menu.tsx`**

- 修改API调用为 `tenantAPI.getMenuList`
- 移除编辑、删除功能，改为跳转链接
- 增强批量操作功能
- 添加分析功能

2. **`admin-web/src/pages/recipe/List.tsx`**

- 确保使用 `tenantAPI.getMenuList`
- 添加跳转到菜单碳足迹的按钮
- 移除批量导入功能（如有）

3. **`admin-web/src/services/cloudbase.ts`**

- 确认API定义一致性

4. **新增共享文件**

- `admin-web/src/types/menuItem.ts` - 统一的菜单项类型定义
- `admin-web/src/utils/menuItemTransform.ts` - 数据转换工具函数
- `admin-web/src/components/carbon/CarbonFootprintDisplay.tsx` - 碳足迹显示组件
- `admin-web/src/components/carbon/CalculationLevelTag.tsx` - 计算级别标签组件

## 五、验收标准

1. **功能完整性**

- ✅ 菜谱列表包含所有菜单运营管理功能
- ✅ 菜单碳足迹包含所有碳足迹专项功能
- ✅ 两个页面间可以顺畅跳转

2. **数据一致性**

- ✅ 两个页面显示的数据保持一致
- ✅ 在一个页面的操作能及时反映到另一个页面

3. **用户体验**

- ✅ 功能定位清晰，用户能快速找到所需功能
- ✅ 减少重复操作
- ✅ 页面跳转顺畅

4. **代码质量**

- ✅ 减少重复代码
- ✅ 代码结构清晰
- ✅ 类型定义统一