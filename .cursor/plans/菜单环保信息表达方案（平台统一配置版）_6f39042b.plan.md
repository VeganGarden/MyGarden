---
name: 菜单环保信息表达方案（平台统一配置版）
overview: 基于全球实践研究和现有系统，设计一套完整的菜单环保信息表达方案。所有配置在气候餐厅平台管理后台统一管理，收银系统、菜单展示等呈现方通过API接口获取已配置好的标签信息，实现统一管理和灵活展示。
todos:
  - id: research_global_practices
    content: 完成全球现状研究，整理国际实践案例和研究成果，输出研究报告文档
    status: completed
  - id: design_config_structure
    content: 设计平台配置管理的数据结构和配置模型，输出平台配置管理设计文档
    status: completed
    dependencies:
      - research_global_practices
  - id: design_api_interfaces
    content: 设计标签查询API接口（菜单标签、订单标签、配置查询），输出API接口规范文档
    status: completed
    dependencies:
      - design_config_structure
  - id: design_visual_system
    content: 设计视觉标识系统（图标、颜色、尺寸规范），输出视觉设计规范文档
    status: completed
    dependencies:
      - design_config_structure
  - id: define_display_levels
    content: 定义4个展示级别（极简/基础/详细/完整），输出展示级别配置说明文档
    status: completed
    dependencies:
      - design_visual_system
  - id: multi_media_adaptation
    content: 设计多媒介适配方案（纸质/电子/移动端/在线/小票），输出多媒介适配指南
    status: completed
    dependencies:
      - define_display_levels
  - id: integration_guide
    content: 编写呈现方集成指南（收银系统、菜单展示系统等如何调用API），输出集成指南文档
    status: completed
    dependencies:
      - design_api_interfaces
  - id: best_practices
    content: 整理最佳实践案例和设计参考，输出最佳实践文档
    status: completed
    dependencies:
      - multi_media_adaptation
      - integration_guide
  - id: restaurant_manual
    content: 编写面向餐厅的使用手册和配置指南
    status: completed
    dependencies:
      - design_config_structure
---

# 菜

单环保信息表达方案（平台统一配置版）

## 一、项目概述

### 1.1 目标

设计一套完整的菜单环保信息表达方案，**所有配置在气候餐厅平台统一管理**，呈现方（收银系统、菜单展示系统等）通过API接口获取已配置好的标签信息，实现统一管理和灵活展示。

### 1.2 核心原则

- **统一配置**：所有展示配置在气候餐厅平台管理后台完成
- **接口获取**：呈现方通过API接口获取标签信息，无需单独配置
- **灵活展示**：呈现方可根据自身媒介特点选择展示内容
- **数据驱动**：标签信息由平台计算和生成，确保准确性

### 1.3 适用范围

- 纸质菜单（通过API获取标签数据后打印）
- 电子菜单（点餐屏幕/平板）
- 手机App/小程序
- 在线菜单（网站/外卖平台）
- 收银系统界面
- 小票打印

## 二、系统架构

### 2.1 架构设计

```javascript
┌─────────────────────────────────────────────────────────┐
│           气候餐厅平台（统一配置管理）                      │
│  ┌──────────────────────────────────────────────────┐  │
│  │  管理后台                                         │  │
│  │  - 菜单环保信息展示配置                           │  │
│  │  - 视觉样式配置                                   │  │
│  │  - 展示级别配置                                   │  │
│  └──────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────┐  │
│  │  数据计算引擎                                     │  │
│  │  - 碳足迹计算                                     │  │
│  │  - 碳标签生成                                     │  │
│  │  - 标签格式化                                     │  │
│  └──────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────┐  │
│  │  API接口层                                       │  │
│  │  - 菜单标签查询接口                              │  │
│  │  - 订单标签查询接口                              │  │
│  │  - 标签配置查询接口                              │  │
│  └──────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
                        │ API接口
                        │ (HTTPS)
        ┌───────────────┼───────────────┐
        │               │               │
┌───────▼──────┐ ┌──────▼──────┐ ┌──────▼──────┐
│  收银系统    │ │  菜单展示    │ │  移动端App  │
│  (POS)      │ │  系统        │ │  小程序     │
│             │ │             │ │             │
│ 调用API获取  │ │ 调用API获取  │ │ 调用API获取  │
│ 标签信息    │ │ 标签信息    │ │ 标签信息    │
│ 展示在界面  │ │ 展示在菜单  │ │ 展示在界面  │
└─────────────┘ └─────────────┘ └─────────────┘
```



### 2.2 数据流

1. **配置阶段**：餐厅管理员在平台管理后台配置展示参数
2. **计算阶段**：平台自动计算菜品碳足迹，生成碳标签
3. **存储阶段**：标签信息存储在平台数据库
4. **获取阶段**：呈现方通过API接口获取标签信息
5. **展示阶段**：呈现方根据自身媒介特点展示标签

## 三、平台配置管理设计

### 3.1 配置数据结构

在气候餐厅平台管理后台，为每个餐厅配置菜单环保信息展示参数：

```javascript
// 存储在 restaurant_menu_display_configs 集合
{
  _id: "config_001",
  restaurantId: "rest_123456",
  tenantId: "tenant_001",
  
  // 全局展示配置
  globalConfig: {
    // 默认展示级别
    defaultDisplayLevel: "basic", // minimal | basic | detailed | comprehensive
    
    // 是否启用环保信息展示
    enabled: true,
    
    // 启用时间（可设置定时启用）
    enabledFrom: "2025-01-01T00:00:00Z",
    enabledTo: null, // null表示永久启用
  },
  
  // 各媒介的展示配置（可覆盖全局配置）
  mediaConfig: {
    physicalMenu: {
      displayLevel: "minimal",    // 纸质菜单使用极简模式
      showContent: {
        icon: true,
        levelText: false,
        value: false,
        reductionPercent: false
      }
    },
    digitalMenu: {
      displayLevel: "basic",      // 电子菜单使用基础模式
      showContent: {
        icon: true,
        levelText: true,
        value: false,
        reductionPercent: true
      }
    },
    mobileApp: {
      displayLevel: "detailed",   // 移动端使用详细模式
      showContent: {
        icon: true,
        levelText: true,
        value: true,
        reductionPercent: true,
        baseline: false
      }
    },
    onlineMenu: {
      displayLevel: "detailed",   // 在线菜单使用详细模式
      showContent: {
        icon: true,
        levelText: true,
        value: true,
        reductionPercent: true,
        baseline: false
      }
    },
    posSystem: {
      displayLevel: "basic",      // 收银系统使用基础模式
      showContent: {
        icon: true,
        levelText: true,
        value: false,
        reductionPercent: true
      }
    },
    receipt: {
      displayLevel: "minimal",    // 小票使用极简模式
      showContent: {
        icon: false,
        levelText: false,
        value: true,
        reductionPercent: true
      },
      // 小票特殊配置
      showOrderSummary: true,      // 显示订单总碳足迹
      showReductionMessage: true   // 显示感谢信息
    }
  },
  
  // 视觉样式配置
  styleConfig: {
    iconSize: "medium",           // small | medium | large
    colorScheme: "standard",      // standard | colorful | minimal
    iconPosition: "afterName",    // beforeName | afterName | belowName
    // 自定义颜色（可选）
    customColors: {
      low: "#4CAF50",             // 低碳颜色
      medium: "#FFC107",          // 中碳颜色
      high: "#FF9800"             // 高碳颜色
    }
  },
  
  // 特殊功能配置
  features: {
    enableFilter: true,           // 启用筛选功能
    enableSort: true,             // 启用排序功能
    enableRecommendation: true,   // 启用推荐专区
    enableAchievement: true,      // 启用成就激励
    enableComparison: false       // 启用对比功能
  },
  
  // 文本自定义（多语言支持）
  textConfig: {
    zh_CN: {
      low: "低碳",
      medium: "达标",
      high: "高碳",
      reduction: "减排",
      carbonFootprint: "碳足迹",
      unit: "kg CO₂e"
    },
    en_US: {
      low: "Low Carbon",
      medium: "Standard",
      high: "High Carbon",
      reduction: "Reduction",
      carbonFootprint: "Carbon Footprint",
      unit: "kg CO₂e"
    }
  },
  
  // 元数据
  createdAt: "2025-01-15T10:00:00Z",
  updatedAt: "2025-01-15T10:00:00Z",
  createdBy: "admin_001",
  version: 1
}
```



### 3.2 配置管理界面设计

在气候餐厅平台管理后台，提供配置管理界面：**功能模块**：

1. **展示级别配置**

- 全局默认级别选择
- 各媒介级别配置（可覆盖全局）

2. **显示内容配置**

- 勾选需要显示的内容项（图标、文字、数值等）

3. **视觉样式配置**

- 图标尺寸选择
- 颜色方案选择
- 自定义颜色设置

4. **功能开关**

- 筛选、排序、推荐等功能开关

5. **文本自定义**

- 多语言文本配置

6. **预览功能**

- 实时预览不同媒介的展示效果

## 四、API接口设计

### 4.1 菜单标签查询接口

**接口路径**：`GET /api/v1/restaurants/{restaurantId}/menu-items/{menuItemId}/carbon-label`**功能**：获取单个菜单项的碳标签信息（已根据配置格式化）**请求参数**：

```javascript
{
  restaurantId: "rest_123456",
  menuItemId: "menu_001",
  media: "mobileApp",  // 指定媒介类型，用于应用对应配置
  language: "zh_CN"    // 语言代码，用于多语言文本
}
```

**响应数据**：

```javascript
{
  code: 0,
  message: "成功",
  data: {
    menuItemId: "menu_001",
    itemName: "素麻婆豆腐",
    
    // 碳标签信息（已根据配置格式化）
    carbonLabel: {
      level: "low",
      icon: {
        url: "https://cdn.climate-restaurant.com/labels/low-carbon.png",
        size: "medium",
        position: "afterName"
      },
      text: {
        levelText: "低碳",           // 根据配置决定是否包含
        value: "0.45 kg CO₂e",      // 根据配置决定是否包含
        reductionPercent: "减排62%", // 根据配置决定是否包含
        description: "低碳排放菜品"   // 根据配置决定是否包含
      },
      // 完整数据（供需要详细信息的场景使用）
      fullData: {
        carbonFootprint: {
          value: 0.45,
          unit: "kg CO₂e",
          baseline: 1.2,
          reduction: 0.75,
          reductionPercent: 62.5
        },
        carbonLevel: "low"
      }
    },
    
    // 展示建议（根据配置生成）
    displaySuggestion: {
      recommendedLevel: "detailed",  // 推荐使用的展示级别
      showInRecommendation: true,     // 是否显示在推荐专区
      sortPriority: 1                 // 排序优先级（用于推荐排序）
    }
  }
}
```



### 4.2 菜单列表标签查询接口

**接口路径**：`GET /api/v1/restaurants/{restaurantId}/menu-items/carbon-labels`**功能**：批量获取菜单项的碳标签信息**请求参数**：

```javascript
{
  restaurantId: "rest_123456",
  menuItemIds: ["menu_001", "menu_002", ...], // 可选，不传则返回全部
  media: "digitalMenu",
  language: "zh_CN",
  filter: {
    carbonLevel: "low"  // 可选，筛选特定碳等级
  },
  sort: {
    field: "carbonFootprint",  // carbonFootprint | reductionPercent
    order: "asc"               // asc | desc
  }
}
```

**响应数据**：

```javascript
{
  code: 0,
  message: "成功",
  data: {
    items: [
      {
        menuItemId: "menu_001",
        itemName: "素麻婆豆腐",
        carbonLabel: { /* 同单个接口格式 */ }
      },
      // ...
    ],
    summary: {
      totalCount: 50,
      lowCarbonCount: 30,
      mediumCarbonCount: 15,
      highCarbonCount: 5
    }
  }
}
```



### 4.3 订单标签查询接口

**接口路径**：`GET /api/v1/orders/{orderId}/carbon-label`**功能**：获取订单的碳足迹标签信息**请求参数**：

```javascript
{
  orderId: "ORDER_001",
  media: "receipt",
  language: "zh_CN"
}
```

**响应数据**：

```javascript
{
  code: 0,
  message: "成功",
  data: {
    orderId: "ORDER_001",
    carbonImpact: {
      totalCarbonFootprint: 0.90,
      unit: "kg CO₂e",
      baseline: 2.40,
      carbonReduction: 1.50,
      reductionPercent: 62.5,
      carbonLevel: "low"
    },
    // 格式化后的展示文本（根据配置）
    displayText: {
      summary: "本订单碳足迹：0.90 kg CO₂e",
      reduction: "相比基准减排：1.50 kg CO₂e（62%）",
      message: "感谢您为环保做出的贡献！"
    },
    items: [
      {
        menuItemId: "menu_001",
        carbonLabel: { /* 同菜单标签格式 */ }
      }
    ]
  }
}
```



### 4.4 配置查询接口

**接口路径**：`GET /api/v1/restaurants/{restaurantId}/menu-display-config`**功能**：获取餐厅的菜单展示配置（供呈现方参考）**请求参数**：

```javascript
{
  restaurantId: "rest_123456"
}
```

**响应数据**：

```javascript
{
  code: 0,
  message: "成功",
  data: {
    restaurantId: "rest_123456",
    globalConfig: { /* 配置数据 */ },
    mediaConfig: { /* 各媒介配置 */ },
    styleConfig: { /* 样式配置 */ },
    textConfig: { /* 文本配置 */ }
  }
}
```



## 五、呈现方集成指南

### 5.1 收银系统集成

收银系统通过API获取标签信息后，在以下场景展示：

1. **点餐界面**

- 调用菜单列表标签接口
- 在菜品名称旁显示碳标签图标
- 支持筛选和排序功能

2. **订单确认界面**

- 显示订单总碳足迹
- 显示每个菜品的碳标签

3. **小票打印**

- 调用订单标签接口
- 在小票底部打印碳足迹信息

### 5.2 菜单展示系统集成

1. **电子菜单屏**

- 定期调用菜单列表标签接口（建议缓存，每小时更新）
- 根据配置的展示级别渲染标签

2. **在线菜单**

- 页面加载时调用菜单列表标签接口
- 支持交互式展示（点击查看详情）

### 5.3 移动端App/小程序集成

1. **菜单列表页**

- 调用菜单列表标签接口
- 显示碳标签图标和文字

2. **菜品详情页**

- 调用单个菜单项标签接口
- 显示完整的碳足迹信息

3. **订单页面**

- 调用订单标签接口
- 显示订单碳足迹和减排量

## 六、实施步骤

### 阶段1：数据库设计（1周）

- 设计 `restaurant_menu_display_configs` 集合结构
- 设计配置数据模型
- 创建数据库集合和索引

### 阶段2：配置管理功能开发（2-3周）

- 开发管理后台配置界面
- 实现配置的增删改查
- 实现配置预览功能
- 实现配置验证逻辑

### 阶段3：标签生成引擎开发（2周）

- 开发标签格式化引擎（根据配置生成标签）
- 实现多语言支持
- 实现多媒介适配逻辑

### 阶段4：API接口开发（2周）

- 开发菜单标签查询接口
- 开发菜单列表标签查询接口
- 开发订单标签查询接口
- 开发配置查询接口
- 实现接口文档

### 阶段5：测试与优化（1-2周）

- 接口功能测试
- 性能测试（批量查询优化）
- 多媒介展示测试
- 用户体验测试

### 阶段6：文档编写（1周）

- API接口文档
- 集成指南
- 配置使用手册
- 最佳实践文档

## 七、技术要点

### 7.1 性能优化

1. **缓存策略**

- 标签计算结果缓存（碳足迹不常变化）
- 配置数据缓存（配置变更频率低）
- API响应缓存（减少重复计算）

2. **批量查询优化**

- 支持批量获取多个菜单项的标签
- 使用数据库索引优化查询
- 考虑分页处理大量数据

### 7.2 数据一致性

1. **配置变更处理**

- 配置变更后，重新生成标签数据
- 通知呈现方刷新缓存
- 版本控制（配置版本号）

2. **碳足迹更新**

- 碳足迹重新计算后，自动更新标签
- 支持批量更新

### 7.3 扩展性

1. **多语言支持**

- 文本配置支持多语言
- API接口支持语言参数

2. **自定义扩展**

- 支持自定义颜色
- 支持自定义文本
- 预留扩展字段

## 八、文档输出

将创建以下文档文件（保存在 `Docs/项目策划方案/菜单环保信息表达/` 目录）：

1. **全球现状研究报告.md** - 详细的研究发现和案例分析
2. **平台配置管理设计.md** - 配置数据结构、管理界面设计
3. **API接口规范文档.md** - 标签查询接口的详细规范
4. **视觉设计规范.md** - 图标设计、颜色规范、尺寸要求
5. **展示级别配置说明.md** - 各级别的详细说明和示例
6. **多媒介适配指南.md** - 各媒介的具体实施方案
7. **呈现方集成指南.md** - 收银系统、菜单展示等系统的集成指南